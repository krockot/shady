(this.webpackJsonpshady=this.webpackJsonpshady||[]).push([[6],{103:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},120:function(e,t,n){var r={"./apl/apl.js":[139,30],"./asciiarmor/asciiarmor.js":[140,31],"./asn.1/asn.1.js":[141,32],"./asterisk/asterisk.js":[142,33],"./brainfuck/brainfuck.js":[143,34],"./clike/clike.js":[128,2],"./clojure/clojure.js":[144,35],"./cmake/cmake.js":[145,36],"./cobol/cobol.js":[146,37],"./coffeescript/coffeescript.js":[129,38],"./commonlisp/commonlisp.js":[147,39],"./crystal/crystal.js":[148,40],"./css/css.js":[125,1],"./cypher/cypher.js":[149,41],"./d/d.js":[150,42],"./dart/dart.js":[151,2,43],"./diff/diff.js":[152,44],"./django/django.js":[153,0,1,11],"./dockerfile/dockerfile.js":[154,21],"./dtd/dtd.js":[155,45],"./dylan/dylan.js":[156,46],"./ebnf/ebnf.js":[157,47],"./ecl/ecl.js":[158,48],"./eiffel/eiffel.js":[159,49],"./elm/elm.js":[160,50],"./erlang/erlang.js":[161,51],"./factor/factor.js":[162,22],"./fcl/fcl.js":[163,52],"./forth/forth.js":[164,53],"./fortran/fortran.js":[165,54],"./gas/gas.js":[166,55],"./gfm/gfm.js":[167,4,20],"./gherkin/gherkin.js":[168,56],"./go/go.js":[169,57],"./groovy/groovy.js":[170,58],"./haml/haml.js":[171,0,1,14],"./handlebars/handlebars.js":[130,16],"./haskell-literate/haskell-literate.js":[172,26],"./haskell/haskell.js":[131,59],"./haxe/haxe.js":[173,60],"./htmlembedded/htmlembedded.js":[174,0,1,10],"./htmlmixed/htmlmixed.js":[124,0,1,27],"./http/http.js":[175,61],"./idl/idl.js":[176,62],"./javascript/javascript.js":[126,0],"./jinja2/jinja2.js":[177,63],"./jsx/jsx.js":[178,0,28],"./julia/julia.js":[179,64],"./livescript/livescript.js":[180,65],"./lua/lua.js":[181,66],"./markdown/markdown.js":[136,4],"./mathematica/mathematica.js":[182,67],"./mbox/mbox.js":[183,68],"./meta.js":[24],"./mirc/mirc.js":[184,69],"./mllike/mllike.js":[185,70],"./modelica/modelica.js":[186,71],"./mscgen/mscgen.js":[187,72],"./mumps/mumps.js":[188,73],"./nginx/nginx.js":[189,74],"./nsis/nsis.js":[190,23],"./ntriples/ntriples.js":[191,75],"./octave/octave.js":[192,76],"./oz/oz.js":[193,77],"./pascal/pascal.js":[194,78],"./pegjs/pegjs.js":[195,0,79],"./perl/perl.js":[196,80],"./php/php.js":[197,0,1,2,17],"./pig/pig.js":[198,81],"./powershell/powershell.js":[199,82],"./properties/properties.js":[200,83],"./protobuf/protobuf.js":[201,84],"./pug/pug.js":[137,0,1,3],"./puppet/puppet.js":[202,85],"./python/python.js":[132,86],"./q/q.js":[203,87],"./r/r.js":[204,88],"./rpm/rpm.js":[205,89],"./rst/rst.js":[206,13],"./ruby/ruby.js":[127,90],"./rust/rust.js":[207,24],"./sas/sas.js":[208,91],"./sass/sass.js":[134,1,92],"./scheme/scheme.js":[209,93],"./shell/shell.js":[210,94],"./sieve/sieve.js":[211,95],"./slim/slim.js":[212,0,1,15],"./smalltalk/smalltalk.js":[213,96],"./smarty/smarty.js":[214,97],"./solr/solr.js":[215,98],"./soy/soy.js":[216,0,1,18],"./sparql/sparql.js":[217,99],"./spreadsheet/spreadsheet.js":[218,100],"./sql/sql.js":[219,101],"./stex/stex.js":[133,102],"./stylus/stylus.js":[138,5],"./swift/swift.js":[220,103],"./tcl/tcl.js":[221,104],"./textile/textile.js":[222,105],"./tiddlywiki/tiddlywiki.js":[223,106],"./tiki/tiki.js":[224,107],"./toml/toml.js":[225,108],"./tornado/tornado.js":[226,0,1,12],"./troff/troff.js":[227,109],"./ttcn-cfg/ttcn-cfg.js":[229,110],"./ttcn/ttcn.js":[228,111],"./turtle/turtle.js":[230,112],"./twig/twig.js":[231,19],"./vb/vb.js":[232,113],"./vbscript/vbscript.js":[233,114],"./velocity/velocity.js":[234,115],"./verilog/verilog.js":[235,116],"./vhdl/vhdl.js":[236,117],"./vue/vue.js":[237,0,1,5,3,9],"./wast/wast.js":[238,25],"./webidl/webidl.js":[239,118],"./xml/xml.js":[123,119],"./xquery/xquery.js":[240,120],"./yacas/yacas.js":[241,121],"./yaml-frontmatter/yaml-frontmatter.js":[242,29],"./yaml/yaml.js":[135,122],"./z80/z80.js":[243,123]};function i(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n.t(i,7)}))}i.keys=function(){return Object.keys(r)},i.id=120,e.exports=i},121:function(e,t,n){},122:function(e,t,n){"use strict";n.r(t);var r=n(2),i=n.n(r),a=n(6),s=(n(30),n(17)),o=n.n(s),c=n(0),u=n.n(c),l=n(18),d=n(12),p=n(3),h=n(4),f=n(5),b=n(11),v=n(10),m=(n(36),n(8)),g=n(22);function j(e,t){var n,r,i=Object(p.a)(Object(p.a)({},t),{},{connectionType:"binding",group:null!==(n=e.group)&&void 0!==n?n:0,binding:null!==(r=e.binding)&&void 0!==r?r:0});switch(e.bindingType){case"buffer":return function(e,t){var n;switch(e.storageType){case"storage":case"storage-read":case"uniform":break;default:return console.warn("ignoring buffer binding with unknown storage type: ".concat(e.storageType)),null}return Object(p.a)(Object(p.a)({},t),{},{bindingType:"buffer",storageType:null!==(n=e.storageType)&&void 0!==n?n:"storage"})}(e,i);case"sampler":return function(e,t){return Object(p.a)(Object(p.a)({},t),{},{bindingType:"sampler"})}(0,i);case"texture":return function(e,t){return Object(p.a)(Object(p.a)({},t),{},{bindingType:"texture"})}(0,i);default:var a=e;return console.warn("ignoring unknown binding type: ".concat(a.bindingType)),null}}function y(e){var t,n,r={id:e.id,name:null!==(t=e.name)&&void 0!==t?t:e.id,position:null!==(n=e.position)&&void 0!==n?n:{x:100,y:100}};switch(e.type){case"render":return function(e,t){var n,r,i,a,s,o,c,u,l,d,h;return Object(p.a)(Object(p.a)({},t),{},{type:"render",vertexShader:null!==(n=e.vertexShader)&&void 0!==n?n:null,vertexEntryPoint:null!==(r=e.vertexEntryPoint)&&void 0!==r?r:null,fragmentShader:null!==(i=e.fragmentShader)&&void 0!==i?i:null,fragmentEntryPoint:null!==(a=e.fragmentEntryPoint)&&void 0!==a?a:null,topology:null!==(s=e.topology)&&void 0!==s?s:"triangle-list",indexed:null!==(o=e.indexed)&&void 0!==o&&o,numVertices:null!==(c=e.numVertices)&&void 0!==c?c:3,numInstances:null!==(u=e.numInstances)&&void 0!==u?u:1,clear:null!==(l=e.clear)&&void 0!==l&&l,clearColor:null!==(d=e.clearColor)&&void 0!==d?d:{r:0,g:0,b:0,a:0},depthTest:null!==(h=e.depthTest)&&void 0!==h?h:"always"})}(e,r);case"compute":return function(e,t){var n,r,i;return Object(p.a)(Object(p.a)({},t),{},{type:"compute",shader:null!==(n=e.shader)&&void 0!==n?n:null,entryPoint:null!==(r=e.entryPoint)&&void 0!==r?r:null,dispatchSize:null!==(i=e.dispatchSize)&&void 0!==i?i:{x:1,y:1,z:1}})}(e,r);case"buffer":return function(e,t){var n,r;return Object(p.a)(Object(p.a)({},t),{},{type:"buffer",size:null!==(n=e.size)&&void 0!==n?n:16384,init:null!==(r=e.init)&&void 0!==r?r:"zero"})}(e,r);case"texture":return function(e,t){var n,r,i,a,s=null;return e.imageData&&(s=e.imageData instanceof Blob?e.imageData:new Blob([Object(g.toByteArray)(e.imageData)])),Object(p.a)(Object(p.a)({},t),{},{type:"texture",imageData:s,size:null!==(n=e.size)&&void 0!==n?n:{width:1,height:1},format:null!==(r=e.format)&&void 0!==r?r:"rgba8unorm",mipLevelCount:null!==(i=e.mipLevelCount)&&void 0!==i?i:1,sampleCount:null!==(a=e.sampleCount)&&void 0!==a?a:1})}(e,r);case"sampler":return function(e,t){return Object(p.a)(Object(p.a)({},t),{},{type:"sampler"})}(0,r);case"connection":return function(e,t){var n,r,i=Object(p.a)(Object(p.a)({},t),{},{type:"connection",source:null!==(n=e.source)&&void 0!==n?n:"",target:null!==(r=e.target)&&void 0!==r?r:""});switch(e.connectionType){case"binding":return j(e,i);case"queue":return Object(p.a)({connectionType:"queue"},i);default:var a=e;return console.warn("ignoring unknown connection node type: ".concat(a.connectionType)),null}}(e,r);default:var i=e;return console.warn("ignoring unrecognized node type: ".concat(i.type)),null}}function x(e){var t,n;return{id:e.id,name:null!==(t=e.name)&&void 0!==t?t:e.id,code:null!==(n=e.code)&&void 0!==n?n:""}}function _(e){var t,n={nodes:{},shaders:{}},r=Object(m.a)(e.nodes);try{for(r.s();!(t=r.n()).done;){var i=y(t.value);null!==i&&(n.nodes[i.id]=i)}}catch(c){r.e(c)}finally{r.f()}var a,s=Object(m.a)(e.shaders);try{for(s.s();!(a=s.n()).done;){var o=a.value;n.shaders[o.id]=x(o)}}catch(c){s.e(c)}finally{s.f()}return n}function O(e,t){return Object(p.a)(Object(p.a)({},t),{},{type:"render",vertexShader:e.vertexShader,vertexEntryPoint:e.vertexEntryPoint,fragmentShader:e.fragmentShader,fragmentEntryPoint:e.fragmentEntryPoint,topology:e.topology,indexed:e.indexed,numVertices:e.numVertices,numInstances:e.numInstances,clear:e.clear,clearColor:e.clearColor,depthTest:e.depthTest})}function k(e,t){return Object(p.a)(Object(p.a)({},t),{},{type:"compute",shader:e.shader,entryPoint:e.entryPoint,dispatchSize:Object(p.a)({},e.dispatchSize)})}function C(e,t){return Object(p.a)(Object(p.a)({},t),{},{type:"buffer",size:e.size,init:e.init})}function w(e,t,n){return T.apply(this,arguments)}function T(){return(T=Object(a.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null,!(t.imageData instanceof Blob)){e.next=13;break}if(!(null===r||void 0===r?void 0:r.serializeBlobs)){e.next=12;break}return e.t0=g.fromByteArray,e.t1=Uint8Array,e.next=7,t.imageData.arrayBuffer();case 7:e.t2=e.sent,e.t3=new e.t1(e.t2),a=(0,e.t0)(e.t3),e.next=13;break;case 12:a=t.imageData;case 13:return e.abrupt("return",Object(p.a)(Object(p.a)({},n),{},{type:"texture",imageData:a,size:t.size,format:t.format,mipLevelCount:t.mipLevelCount,sampleCount:t.sampleCount}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return Object(p.a)(Object(p.a)({},t),{},{type:"sampler"})}function P(e,t){var n=Object(p.a)(Object(p.a)({},t),{},{connectionType:"binding",group:e.group,binding:e.binding});switch(e.bindingType){case"buffer":return function(e,t){return Object(p.a)(Object(p.a)({},t),{},{bindingType:"buffer",storageType:e.storageType})}(e,n);case"texture":return function(e,t){return Object(p.a)(Object(p.a)({},t),{},{bindingType:"texture"})}(0,n);case"sampler":return function(e,t){return Object(p.a)(Object(p.a)({},t),{},{bindingType:"sampler"})}(0,n)}}function B(e,t){var n=Object(p.a)(Object(p.a)({},t),{},{type:"connection",source:e.source,target:e.target});switch(e.connectionType){case"binding":return P(e,n);case"queue":return Object(p.a)(Object(p.a)({},n),{},{connectionType:"queue"})}}function N(e,t){return R.apply(this,arguments)}function R(){return(R=Object(a.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={id:t.id,name:t.name,position:t.position},e.t0=t.type,e.next="render"===e.t0?4:"compute"===e.t0?5:"buffer"===e.t0?6:"texture"===e.t0?7:"sampler"===e.t0?8:"connection"===e.t0?9:10;break;case 4:return e.abrupt("return",O(t,r));case 5:return e.abrupt("return",k(t,r));case 6:return e.abrupt("return",C(t,r));case 7:return e.abrupt("return",w(t,r,n));case 8:return e.abrupt("return",S(0,r));case 9:return e.abrupt("return",B(t,r));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return{id:e.id,name:e.name,code:e.code}}function z(e,t){return D.apply(this,arguments)}function D(){return(D=Object(a.a)(i.a.mark((function e(t,n){var r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Array.from(Object.values(t.nodes)).map(function(){var e=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return r=e.sent,s=Array.from(Object.values(t.shaders)).map((function(e){return M(e)})),e.abrupt("return",{version:1,nodes:r,shaders:s});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=n(7);function A(e,t){if(Array.isArray(e)){if(t.has(e))throw new Error("cycle detected in deep copy");return t.add(e),e.map((function(e){return A(e,t)}))}if(e instanceof Blob)return e;if("object"===typeof e&&null!==e){if(t.has(e))throw new Error("cycle detected in deep copy");t.add(e);for(var n={},r=0,i=Object.entries(e);r<i.length;r++){var a=Object(E.a)(i[r],2),s=a[0],o=a[1];n[s]=A(o,t)}return n}if(null===e||void 0===e)return e;if("number"===typeof e||"string"===typeof e||"boolean"===typeof e)return e;throw new Error("value not deep-copyable")}function V(e){return A(e,new Set)}function U(e,t){return Array.isArray(e)?!(!Array.isArray(t)||e.length!==t.length)&&e.every((function(e,n){return U(e,t[n])})):e instanceof Blob||t instanceof Blob?e===t:"object"===typeof e&&null!==e?"object"===typeof t&&null!==t&&(Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((function(n){return U(e[n],t[n])}))):e===t}function q(e){return I.apply(this,arguments)}function I(){return(I=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Object,e.next=3,Promise.all(Array.from(Object.entries(t)).map(function(){var e=Object(a.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(E.a)(t,2),r=n[0],a=n[1],e.t0=r,e.next=4,a;case 4:return e.t1=e.sent,e.abrupt("return",[e.t0,e.t1]);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.fromEntries.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){function n(e){return"object"===typeof e&&null!==e&&e.constructor===Object}for(var r=0,i=Object.entries(t);r<i.length;r++){var a=Object(E.a)(i[r],2),s=a[0],o=a[1];e.hasOwnProperty(s)&&n(o)&&n(e[s])?L(e[s],o):n(o)||Array.isArray(o)?e[s]=V(o):e[s]=o}return e}var F=function(){function e(){var t=this;Object(h.a)(this,e),this.adapter_=void 0,this.device_=void 0,this.lost_=void 0,this.pendingAcquisition_=void 0,this.onAcquired=void 0,this.onLost=void 0,this.acquire=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===t.pendingAcquisition_&&(t.pendingAcquisition_=t.acquireInternal_()),e.abrupt("return",t.pendingAcquisition_);case 2:case"end":return e.stop()}}),e)}))),this.release=function(){if(!t.isAcquired)throw new Error("not acquired");t.adapter_=null,t.device_=null},this.onLost_=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.warn("Lost GPU. Reacquiring after short delay..."),t.adapter_=null,t.device_=null,null==t.onLost){e.next=6;break}return e.next=6,t.onLost();case 6:return e.next=8,new Promise((function(e){return setTimeout(e,1e3)}));case 8:case"end":return e.stop()}}),e)}))),this.adapter_=null,this.device_=null,this.lost_=!1,this.pendingAcquisition_=null,this.onAcquired=null,this.onLost=null,this.acquire()}return Object(f.a)(e,[{key:"isAcquired",get:function(){return null!==this.adapter_}},{key:"isLost",get:function(){return!this.isAcquired}},{key:"adapter",get:function(){return this.adapter_}},{key:"device",get:function(){return this.device_}},{key:"acquireInternal_",value:function(){var e=Object(a.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAcquired){e.next=2;break}throw new Error("already acquired.");case 2:return e.next=4,navigator.gpu.requestAdapter();case 4:if(t=e.sent){e.next=7;break}throw new Error("no webgpu adapter available");case 7:return e.prev=7,e.next=10,t.requestDevice();case 10:if(n=e.sent){e.next=13;break}throw new Error("no webgpu device available");case 13:this.device_=n,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.log(e.t0);case 19:if(this.pendingAcquisition_=null,this.adapter_=t,this.device_.lost.then(this.onLost_),null===this.onAcquired){e.next=25;break}return e.next=25,this.onAcquired();case 25:case"end":return e.stop()}}),e,this,[[7,16]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),G=function(){function e(t){Object(h.a)(this,e),this.compiler_=void 0,this.cache_=void 0,this.compiler_=t,this.cache_=new Map}return Object(f.a)(e,[{key:"keys",value:function(){return this.cache_.keys()}},{key:"entries",value:function(){return this.cache_.entries()}},{key:"get",value:function(e){var t;return null!==(t=this.cache_.get(e))&&void 0!==t?t:null}},{key:"replace",value:function(e){var t,n=Object(m.a)(this.cache_.entries());try{for(n.s();!(t=n.n()).done;){var r=Object(E.a)(t.value,2),i=r[0],a=r[1];e.get(i)||a.dispose()}}catch(s){n.e(s)}finally{n.f()}this.cache_=e.cache_}},{key:"dispose",value:function(){for(var e=0,t=Object.values(this.cache_);e<t.length;e++){t[e].dispose()}}},{key:"compile",value:function(){var t=Object(a.a)(i.a.mark((function t(n){var r,a,s,o,c,u,l,d,p,h,f,b;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new e(this.compiler_),a=[],s=Object(m.a)(this.compiler_.getCurrentDescriptors(n));try{for(s.s();!(o=s.n()).done;)c=o.value,(u=this.cache_.get(c.id))&&!this.compiler_.needsRecompile(c,u,n)?r.cache_.set(c.id,u):a.push({id:c.id,update:this.compiler_.compile(c,n)})}catch(i){s.e(i)}finally{s.f()}l=0,d=a;case 5:if(!(l<d.length)){t.next=14;break}return p=d[l],h=p.id,f=p.update,t.next=9,f;case 9:null!==(b=t.sent)&&r.cache_.set(h,b);case 11:l++,t.next=5;break;case 14:return t.abrupt("return",r);case 15:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),e}();function H(e){for(var t=0;t<e.byteLength;t+=65536){var n=Math.min(65536,e.byteLength-t),r=new Uint32Array(e.buffer,t,n/4);crypto.getRandomValues(r)}}var K=function(){function e(t,n,r,i){Object(h.a)(this,e),this.size_=void 0,this.init_=void 0,this.usage_=void 0,this.buffer_=void 0,this.size_=t,this.init_=n,this.usage_=r,this.buffer_=i}return Object(f.a)(e,[{key:"size",get:function(){return this.size_}},{key:"init",get:function(){return this.init_}},{key:"usage",get:function(){return this.usage_}},{key:"buffer",get:function(){return this.buffer_}},{key:"dispose",value:function(){this.buffer_.destroy()}}]),e}(),W=function(){function e(t){Object(h.a)(this,e),this.device_=void 0,this.device_=t}return Object(f.a)(e,[{key:"getCurrentDescriptors",value:function(e){return e.buffers.values()}},{key:"needsRecompile",value:function(e,t,n){return e.size!==t.size||e.init!==t.init||n.bufferUsage.get(e.id)!==t.usage}},{key:"compile",value:function(){var e=Object(a.a)(i.a.mark((function e(t,n){var r,a,s,o,c,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.bufferUsage.get(t.id)){e.next=3;break}return e.abrupt("return",null);case 3:if(s="zero"!==t.init,o=this.device_.createBuffer({size:t.size,usage:a,mappedAtCreation:s})){e.next=7;break}return e.abrupt("return",null);case 7:return s&&(c=o.getMappedRange(0,t.size),u=new Uint32Array(c),l=new Float32Array(c),H(u),"random-floats"===t.init&&u.forEach((function(e,t){l[t]=e/Math.pow(2,31)-1})),o.unmap()),e.abrupt("return",new K(t.size,null!==(r=t.init)&&void 0!==r?r:"zero",a,o));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function X(e){return new G(new W(e))}var Y=function(){function e(t){Object(h.a)(this,e),this.sampler_=void 0,this.sampler_=t}return Object(f.a)(e,[{key:"sampler",get:function(){return this.sampler_}},{key:"dispose",value:function(){}}]),e}(),Q=function(){function e(t){Object(h.a)(this,e),this.device_=void 0,this.device_=t}return Object(f.a)(e,[{key:"getCurrentDescriptors",value:function(e){return e.samplers.values()}},{key:"needsRecompile",value:function(e,t,n){return!1}},{key:"compile",value:function(){var e=Object(a.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Y(this.device_.createSampler()));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function Z(e){return new G(new Q(e))}var J="// All shader sources are prefixed with the definitions below, providing a\n// set of builtin uniform inputs which are updated by the application before\n// each frame iteration.\n[[block]] struct BuiltinUniforms {\n  // The time in seconds since the application loaded.\n  time: f32;\n\n  // The time in seconds since the last frame iteration. Zero for the first\n  // frame.\n  timeDelta: f32;\n\n  // The count of the current frame. The first frame is frame 0.\n  frame: u32;\n\n  // The resolution in pixels of the main output texture displayed by the app.\n  [[align(16)]] resolution: vec2<u32>;\n};\n\n// All builtin uniforms are accessible to all shaders through this global.\n[[group(0), binding(0)]] var<uniform> builtinUniforms: BuiltinUniforms;\n",$=J.split(/\r\n|\r|\n/).length,ee=function(){function e(t,n,r){Object(h.a)(this,e),this.code_=void 0,this.module_=void 0,this.messages_=void 0,this.code_=t,this.module_=n,this.messages_=r}return Object(f.a)(e,[{key:"code",get:function(){return this.code_}},{key:"module",get:function(){return this.module_}},{key:"messages",get:function(){return this.messages_}},{key:"dispose",value:function(){}}]),e}(),te=function(){function e(t){Object(h.a)(this,e),this.device_=void 0,this.device_=t}return Object(f.a)(e,[{key:"getCurrentDescriptors",value:function(e){return e.shaders.values()}},{key:"needsRecompile",value:function(e,t,n){return e.code!==t.code}},{key:"compile",value:function(){var e=Object(a.a)(i.a.mark((function e(t,n){var r,a,s,o,c,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.device_.createShaderModule({code:J+t.code}),e.next=3,r.compilationInfo();case 3:a=e.sent,s=!1,o=[],c=Object(m.a)(a.messages);try{for(c.s();!(u=c.n()).done;)"error"===(l=u.value).type&&(s=!0),o.push({message:l.message,type:l.type,lineNum:l.lineNum-$,linePos:l.linePos,offset:l.offset,length:l.length})}catch(n){c.e(n)}finally{c.f()}return e.abrupt("return",new ee(t.code,s?null:r,o));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function ne(e){return new G(new te(e))}var re=function(){function e(t,n,r){Object(h.a)(this,e),this.imageData_=void 0,this.bitmap_=void 0,this.texture_=void 0,this.imageData_=t,this.bitmap_=n,this.texture_=r}return Object(f.a)(e,[{key:"imageData",get:function(){return this.imageData_}},{key:"bitmap",get:function(){return this.bitmap_}},{key:"texture",get:function(){return this.texture_}},{key:"dispose",value:function(){this.texture_.destroy()}}]),e}(),ie=function(){function e(t){Object(h.a)(this,e),this.device_=void 0,this.device_=t}return Object(f.a)(e,[{key:"getCurrentDescriptors",value:function(e){return e.textures.values()}},{key:"needsRecompile",value:function(e,t,n){return e.imageData!==t.imageData}},{key:"compile",value:function(){var e=Object(a.a)(i.a.mark((function e(t,n){var r,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.imageData){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,createImageBitmap(t.imageData);case 4:return r=e.sent,a={width:r.width,height:r.height},s=this.device_.createTexture({size:a,format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),this.device_.queue.copyExternalImageToTexture({source:r},{texture:s},a),e.abrupt("return",new re(t.imageData,r,s));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function ae(e){return new G(new ie(e))}var se=n(20),oe=function(){function e(t){Object(h.a)(this,e),this.blueprint=void 0,this.shaders=void 0,this.buffers=void 0,this.textures=void 0,this.samplers=void 0,this.passes=void 0,this.bindings=void 0,this.bufferUsage=void 0,this.textureUsage=void 0,this.passOrder=void 0,this.blueprint=V(t),this.shaders=new Map(Object.values(this.blueprint.shaders).map((function(e){return[e.id,e]}))),this.buffers=new Map,this.textures=new Map,this.samplers=new Map,this.passes=new Map,this.bindings=new Map,this.bufferUsage=new Map,this.textureUsage=new Map,this.passOrder=[],this.populate_()}return Object(f.a)(e,[{key:"populate_",value:function(){for(var e,t,n=[],r={incoming:new Map,outgoing:new Map},i=0,a=Object.entries(this.blueprint.nodes);i<a.length;i++){var s=Object(E.a)(a[i],2),o=s[0],c=s[1];switch(c.type){case"buffer":this.buffers.set(o,c);break;case"texture":this.textures.set(o,c);break;case"sampler":this.samplers.set(o,c);break;case"connection":switch(c.connectionType){case"binding":n.push(c);break;case"queue":var u=null!==(e=r.incoming.get(c.target))&&void 0!==e?e:new Set,l=null!==(t=r.outgoing.get(c.source))&&void 0!==t?t:new Set;u.add(c.source),l.add(c.target),r.incoming.set(c.target,u),r.outgoing.set(c.source,l)}break;case"compute":case"render":this.passes.set(o,c)}}this.populateBindings_(n),this.computePassOrder_(r)}},{key:"populateBindings_",value:function(e){var t,n=Object(m.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=this.passes.get(r.target);if(i)if(r.group>=4)console.warn("invalid bind group ".concat(r.group));else{var a=this.bindings.get(r.target);a||(a=[],this.bindings.set(r.target,a));var s=this.blueprint.nodes[r.source];if(s&&s.type===r.bindingType)switch(r.bindingType){case"buffer":var o=this.buffers.get(s.id);if(!o){console.warn("ignoring unknown buffer: ".concat(r.source));continue}this.compileBufferBinding_(i.type,a,o,r);break;case"texture":var c=this.textures.get(s.id);if(!c){console.warn("ignoring unknown texture: ".concat(r.source));continue}this.compileTextureBinding_(i.type,a,c,r);break;case"sampler":var u=this.samplers.get(s.id);if(!u){console.warn("ignoring unknown sampler: ".concat(r.source));continue}this.compileSamplerBinding_(i.type,a,u,r)}else console.warn("ignoring unknown binding source ".concat(r.source))}else console.warn("ignoring unknown pass: ".concat(r.target))}}catch(l){n.e(l)}finally{n.f()}}},{key:"computePassOrder_",value:function(e){var t,n=new Set(this.passes.keys()),r=Object(m.a)(e.incoming.keys());try{for(r.s();!(t=r.n()).done;){var i=t.value;n.delete(i)}}catch(v){r.e(v)}finally{r.f()}for(var a=Array.from(n);0!==a.length;){var s;(s=this.passOrder).push.apply(s,Object(se.a)(a));var o,c=[],u=Object(m.a)(a);try{for(u.s();!(o=u.n()).done;){var l=o.value,d=e.outgoing.get(l);if(d){var p,h=Object(m.a)(d.values());try{for(h.s();!(p=h.n()).done;){var f=p.value,b=e.incoming.get(f);b&&(b.delete(l),0===b.size&&c.push(f))}}catch(v){h.e(v)}finally{h.f()}}}}catch(v){u.e(v)}finally{u.f()}a=c}}},{key:"compileBufferBinding_",value:function(e,t,n,r){var i,a,s=0;switch(r.storageType){case"storage-read":s=GPUBufferUsage.STORAGE,a="read-only-storage";break;case"storage":s=GPUBufferUsage.STORAGE,a="storage";break;case"uniform":s=GPUBufferUsage.UNIFORM,a="uniform"}this.bufferUsage.set(n.id,(null!==(i=this.bufferUsage.get(n.id))&&void 0!==i?i:0)|s);var o={binding:r.binding,visibility:ue(e),buffer:{type:a}};ce(t,r.group,o,n)}},{key:"compileTextureBinding_",value:function(e,t,n,r){var i={binding:r.binding,visibility:ue(e),texture:{}};ce(t,r.group,i,n)}},{key:"compileSamplerBinding_",value:function(e,t,n,r){var i={binding:r.binding,visibility:ue(e),sampler:{}};ce(t,r.group,i,n)}}]),e}();function ce(e,t,n,r){for(;t>=e.length;)e.push(new Map);var i=n.binding,a=e[t];a.has(i)?console.warn("ignoring duplicate binding (".concat(t,", ").concat(i,")")):a.set(i,{layoutEntry:n,node:r})}function ue(e){return"render"===e?GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT:GPUShaderStage.COMPUTE}var le=function(){function e(t){Object(h.a)(this,e),this.device_=void 0,this.lastCompile_=void 0,this.caches_=void 0,this.programMap_=void 0,this.device_=t,this.lastCompile_=null,this.caches_={shaders:ne(t),buffers:X(t),textures:ae(t),samplers:Z(t)},this.programMap_=null}return Object(f.a)(e,[{key:"dispose",value:function(){this.caches_.shaders.dispose(),this.caches_.buffers.dispose(),this.caches_.textures.dispose(),this.caches_.samplers.dispose()}},{key:"programMap",get:function(){return this.programMap_}},{key:"shaders",get:function(){return this.caches_.shaders}},{key:"buffers",get:function(){return this.caches_.buffers}},{key:"textures",get:function(){return this.caches_.textures}},{key:"samplers",get:function(){return this.caches_.samplers}},{key:"update",value:function(){var e=Object(a.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new oe(t),r=this.doCompile_(n),this.lastCompile_=r,e.next=5,r;case 5:if(a=e.sent,this.lastCompile_===r){e.next=10;break}return e.next=9,this.lastCompile_;case 9:return e.abrupt("return");case 10:this.programMap_=n,this.caches_.shaders.replace(a.shaders),this.caches_.buffers.replace(a.buffers),this.caches_.textures.replace(a.textures),this.caches_.samplers.replace(a.samplers);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"doCompile_",value:function(){var e=Object(a.a)(i.a.mark((function e(t){var n,r,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.caches_.shaders.compile(t),r=this.caches_.buffers.compile(t),a=this.caches_.textures.compile(t),s=this.caches_.samplers.compile(t),e.next=6,q({shaders:n,buffers:r,textures:a,samplers:s});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),de=function(){function e(t,n){Object(h.a)(this,e),this.device_=void 0,this.passes_=void 0,this.outputDepthStencilTexture_=void 0,this.outputDepthStencilTextureSize_=void 0,this.device_=t,this.passes_=n,this.outputDepthStencilTexture_=null,this.outputDepthStencilTextureSize_={width:0,height:0}}return Object(f.a)(e,[{key:"run",value:function(e,t){var n=t.width,r=t.height,i=this.device_;null!==this.outputDepthStencilTexture_&&this.outputDepthStencilTextureSize_.width===n&&this.outputDepthStencilTextureSize_.height===r||(null!==this.outputDepthStencilTexture_&&(this.outputDepthStencilTexture_.destroy(),this.outputDepthStencilTexture_=null),this.outputDepthStencilTexture_=i.createTexture({size:{width:n,height:r},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.outputDepthStencilTextureSize_={width:n,height:r}),i.queue.submit([this.encodeCommands_(e)])}},{key:"encodeCommands_",value:function(e){var t,n=this.device_.createCommandEncoder(),r=Object(m.a)(this.passes_);try{for(r.s();!(t=r.n()).done;){var i=t.value;switch(i.type){case"render":this.encodeRenderCommands_(i,n,e);break;case"compute":this.encodeComputeCommands_(i,n)}}}catch(a){r.e(a)}finally{r.f()}return n.finish()}},{key:"encodeRenderCommands_",value:function(e,t,n){var r,i=e.node.clear?null!==(r=e.node.clearColor)&&void 0!==r?r:{r:0,g:0,b:0,a:1}:"load",a=this.outputDepthStencilTexture_,s=t.beginRenderPass({colorAttachments:[{view:n.createView(),loadValue:i,storeOp:"store"}],depthStencilAttachment:{view:a.createView(),depthLoadValue:e.node.clear?1:"load",depthStoreOp:"store",stencilLoadValue:1,stencilStoreOp:"store"}});s.executeBundles([e.bundle]),s.endPass()}},{key:"encodeComputeCommands_",value:function(e,t){var n=t.beginComputePass(),r=e.node.dispatchSize;n.setPipeline(e.pipeline),e.bindGroups.forEach((function(e,t){n.setBindGroup(t,e)})),n.dispatch(Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),n.endPass()}}]),e}();function pe(e,t){var n=e.node;switch(n.type){case"buffer":var r=t.buffers.get(n.id);return r?{buffer:r.buffer}:(console.warn("unable to bind missing buffer ".concat(n.name)),null);case"texture":var i=t.textures.get(n.id);return i?i.texture.createView():(console.warn("unable to bind missing texture ".concat(n.name)),null);case"sampler":var a=t.samplers.get(n.id);return a?a.sampler:(console.warn("unable to bind missing sampler ".concat(n.name)),null)}}function he(e,t,n,r,i){var a,s,o=null!==(a=n.programMap.bindings.get(e))&&void 0!==a?a:[],c=[],u=[],l=Object(m.a)(o);try{for(l.s();!(s=l.n()).done;){var d,p=s.value,h=[],f=[],b=Object(m.a)(p.values());try{for(b.s();!(d=b.n()).done;){var v=d.value,g=pe(v,n);g&&(h.push(v.layoutEntry),f.push({binding:v.layoutEntry.binding,resource:g}))}}catch(x){b.e(x)}finally{b.f()}c.push(h),u.push(f)}}catch(x){l.e(x)}finally{l.f()}0===c.length&&(c.push([]),u.push([])),c[0].unshift({binding:0,visibility:r,buffer:{type:"uniform"}}),u[0].unshift({binding:0,resource:{buffer:i}});var j=[],y=[];return c.forEach((function(e,n){var r=t.createBindGroupLayout({entries:e});j.push(r),y.push(t.createBindGroup({layout:r,entries:u[n]}))})),{pipelineLayout:t.createPipelineLayout({bindGroupLayouts:j}),bindGroups:y}}function fe(e,t,n,r,i,a,s){return"render"===n.type?function(e,t,n,r,i,a,s){var o,c;if(null===a.programMap||null===n.vertexShader||null===n.fragmentShader||null===n.vertexEntryPoint||null===n.fragmentEntryPoint)return null;var u=s.shaders[n.vertexShader],l=s.shaders[n.fragmentShader];if(!u||!l)return null;var d=a.shaders.get(u.id),p=a.shaders.get(l.id);if(!d||!p||!d.module||!p.module)return null;var h=he(t,e,a,GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,r),f=null!==(o=n.topology)&&void 0!==o?o:"triangle-list",b="line-strip"===f||"triangle-strip"===f?"uint32":void 0,v=e.createRenderPipeline({layout:h.pipelineLayout,vertex:{module:d.module,entryPoint:n.vertexEntryPoint},primitive:{topology:f,stripIndexFormat:b,cullMode:"none"},fragment:{targets:[{format:i}],module:p.module,entryPoint:n.fragmentEntryPoint},depthStencil:{format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:null!==(c=n.depthTest)&&void 0!==c?c:"always"}}),m=e.createRenderBundleEncoder({colorFormats:[i],depthStencilFormat:"depth24plus-stencil8"});return m.setPipeline(v),h.bindGroups.forEach((function(e,t){e&&m.setBindGroup(t,e)})),m.draw(n.numVertices,n.numInstances),{type:"render",node:n,bundle:m.finish()}}(e,t,n,r,i,a,s):function(e,t,n,r,i,a){if(null===i.programMap||null===n.shader||null===n.entryPoint)return null;var s=a.shaders[n.shader];if(!s)return null;var o=i.shaders.get(s.id);if(!o||!o.module)return null;var c=he(t,e,i,GPUShaderStage.COMPUTE,r),u=e.createComputePipeline({layout:c.pipelineLayout,compute:{module:o.module,entryPoint:n.entryPoint}});return{type:"compute",node:n,bindGroups:c.bindGroups,pipeline:u}}(e,t,n,r,a,s)}function be(e,t,n,r,i){if(null===r.programMap)return null;var a=r.programMap.passes,s=r.programMap.passOrder.map((function(s){return fe(e,s,a.get(s),t,n,r,i)}));return new de(e,s.filter((function(e){return null!==e})))}var ve=function(){function e(t){Object(h.a)(this,e),this.device_=void 0,this.builtinUniforms_=void 0,this.resources_=void 0,this.executable_=void 0,this.blueprint_=void 0,this.outputFormat_=void 0,this.onShadersCompiled_=void 0,this.device_=t,this.builtinUniforms_=t.createBuffer({size:24,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.executable_=null,this.blueprint_=null,this.resources_=new le(t),this.outputFormat_="bgra8unorm",this.onShadersCompiled_=null}return Object(f.a)(e,[{key:"resources",get:function(){return this.resources_}},{key:"onShadersCompiled",set:function(e){this.onShadersCompiled_=e}},{key:"dispose",value:function(){this.builtinUniforms_.destroy(),this.resources_.dispose()}},{key:"setBlueprint",value:function(e){this.blueprint_=e,this.compile_()}},{key:"updateUniforms",value:function(e){var t,n,r,i,a,s,o,c=this.device_,u=new ArrayBuffer(24),l=new Float32Array(u),d=new Uint32Array(u);l[0]=null!==(t=e.time)&&void 0!==t?t:0,l[1]=null!==(n=e.timeDelta)&&void 0!==n?n:0,d[2]=null!==(r=e.frame)&&void 0!==r?r:0,d[4]=null!==(i=null===(a=e.resolution)||void 0===a?void 0:a.width)&&void 0!==i?i:1,d[5]=null!==(s=null===(o=e.resolution)||void 0===o?void 0:o.height)&&void 0!==s?s:1,c.queue.writeBuffer(this.builtinUniforms_,0,u,0,24)}},{key:"run",value:function(e,t,n){if(this.outputFormat_!==n&&null!==this.blueprint_)return this.executable_=null,this.outputFormat_=n,void this.compile_();null!==this.executable_&&this.executable_.run(e,t)}},{key:"compile_",value:function(){var e=Object(a.a)(i.a.mark((function e(){var t,n,r,a,s,o,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.blueprint_,e.next=3,this.resources_.update(t);case 3:if(this.onShadersCompiled_){n=new Map,r=Object(m.a)(this.resources_.shaders.entries());try{for(r.s();!(a=r.n()).done;)s=Object(E.a)(a.value,2),o=s[0],c=s[1],n.set(o,c.messages)}catch(i){r.e(i)}finally{r.f()}this.onShadersCompiled_(n)}this.executable_=be(this.device_,this.builtinUniforms_,this.outputFormat_,this.resources_,t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),me=function(){function e(){var t=this;Object(h.a)(this,e),this.gpu_=void 0,this.lastUsedContext_=void 0,this.lastUsedResolution_=void 0,this.startTime_=void 0,this.lastFrameTime_=void 0,this.frame_=void 0,this.blueprint_=void 0,this.program_=void 0,this.onShadersCompiled_=void 0,this.onGpuAcquired_=function(){t.program_&&t.program_.dispose(),t.program_=new ve(t.gpu_.device),t.blueprint_&&t.program_.setBlueprint(t.blueprint_),t.onShadersCompiled_&&(t.program_.onShadersCompiled=t.onShadersCompiled_)},this.gpu_=new F,this.gpu_.onAcquired=this.onGpuAcquired_,this.frame_=0,this.blueprint_=null,this.program_=null}return Object(f.a)(e,[{key:"onShadersCompiled",set:function(e){this.onShadersCompiled_=e,this.program_&&(this.program_.onShadersCompiled=e)}},{key:"setBlueprint",value:function(e){this.blueprint_&&U(this.blueprint_,e)||(this.blueprint_=V(e),this.program_&&this.program_.setBlueprint(e))}},{key:"stop",value:function(){this.blueprint_=null,this.program_=null}},{key:"render",value:function(e,t){var n;if(this.gpu_&&this.gpu_.isAcquired&&this.program_){var r=function(e){return e.getContext("webgpu")}(e);if(null===r)throw this.stop(),new Error("no webgpu context");var i=this.gpu_.device,a=r.getPreferredFormat(this.gpu_.adapter);this.lastUsedContext_&&this.lastUsedResolution_&&this.lastUsedContext_===r&&this.lastUsedResolution_.width===t.width&&this.lastUsedResolution_.height===t.height||(r.configure({device:i,format:a,size:Object(p.a)({},t)}),this.lastUsedResolution_=Object(p.a)({},t)),e.style.filter="blur(0px)";var s=(new Date).getTime();void 0===this.startTime_&&(this.startTime_=s);var o=s-(null!==(n=this.lastFrameTime_)&&void 0!==n?n:s);this.lastFrameTime_=s,this.program_.updateUniforms({time:(s-this.startTime_)/1e3,timeDelta:o/1e3,frame:this.frame_++,resolution:t}),this.program_.run(r.getCurrentTexture(),t,a)}}}]),e}(),ge=(n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(55),n(56),n(57),n(58),n(59),n(60),n(61),n(62),n(63),n(64),n(65),n(66),n(67),n(68),n(69),n(70),n(71),n(72),n(73),n(74),n(75),n(76),n(77),n(78),n(79),n(80),n(81),n(82),n(83),n(84),n(85),n(86),n(87),n(88),n(89),n(90),n(91),n(92),n(93),n(94),n(95),n(96),n(97),n(98),n(99),n(100),n(101),n(102),["3024-day","3024-night","abbott","abcdef","ambiance-mobile","ambiance","ayu-dark","ayu-mirage","base16-dark","base16-light","bespin","blackboard","cobalt","colorforth","darcula","dracula","duotone-dark","duotone-light","eclipse","elegant","erlang-dark","gruvbox-dark","hopscotch","icecoder","idea","isotope","juejin","lesser-dark","liquibyte","lucario","material-darker","material-ocean","material-palenight","material","mbo","mdn-like","midnight","monokai","moxer","neat","neo","night","nord","oceanic-next","panda-syntax","paraiso-dark","paraiso-light","pastel-on-dark","railscasts","rubyblue","seti","shadowfox","solarized","ssms","the-matrix","tomorrow-night-bright","tomorrow-night-eighties","ttcn","twilight","vibrant-ink","xq-dark","xq-light","yeti","yonce","zenburn"]),je=(n(103),n(1)),ye=function(e){var t=e.label,n=e.children;return Object(je.jsxs)("div",{className:"LabeledField",children:[Object(je.jsx)("div",{className:"Label",children:t}),Object(je.jsx)("div",{className:"Field",children:n})]})},xe=function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).pixelSizeToggleRef_=void 0,r.pixelSizeRef_=void 0,r.framebufferWidthRef_=void 0,r.framebufferHeightRef_=void 0,r.importRef_=void 0,r.saveBlueprint_=function(){var e=prompt("Name it!");null!==e&&""!==e&&r.props.onSaveBlueprint(e)},r.loadBlueprint_=function(e){r.props.onLoadBlueprint(e),r.toggleLoadBlueprintPanel_()},r.copyBlueprintToClipboard_=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=navigator.clipboard,e.t1=JSON,e.next=4,z(r.props.blueprint,{serializeBlobs:!0});case 4:e.t2=e.sent,e.t3=e.t1.stringify.call(e.t1,e.t2),e.t0.writeText.call(e.t0,e.t3);case 7:case"end":return e.stop()}}),e)}))),r.importBlueprintFromClipboard_=function(){if(r.togglePasteMenu_(),r.importRef_.current){var e=r.importRef_.current.value,t=JSON.parse(e);t&&r.props.onImportBlueprint(t)}},r.togglePasteMenu_=function(){r.setState((function(e,t){return{pasteMenuVisible:!e.pasteMenuVisible}}))},r.deleteBlueprint_=function(e){r.props.onDeleteBlueprint(e)},r.toggleLoadBlueprintPanel_=function(){r.setState((function(e,t){return{loadMenuVisible:!e.loadMenuVisible}}))},r.toggleOptions_=function(){r.setState((function(e,t){return{optionsVisible:!e.optionsVisible}}))},r.enterFullscreen_=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:document.querySelector("canvas").requestFullscreen();case 1:case"end":return e.stop()}}),e)}))),r.setAspectRatio_=function(e){r.props.onDisplayConfigChange({aspect:e.currentTarget.value}),r.toggleOptions_()},r.updateResolution_=function(e){var t=e.currentTarget;if(t!==r.pixelSizeToggleRef_.current&&"pixelSize"!==t.name){var n={width:parseInt(r.framebufferWidthRef_.current.value),height:parseInt(r.framebufferHeightRef_.current.value)};isNaN(n.width)||isNaN(n.height)||r.props.onDisplayConfigChange({resolution:{mode:"framebuffer",framebufferSize:n}})}else{var i=parseInt(r.pixelSizeRef_.current.value);isNaN(i)||r.props.onDisplayConfigChange({resolution:{mode:"pixel",pixelSize:i}})}},r.state={optionsVisible:!1,loadMenuVisible:!1,pasteMenuVisible:!1},r.pixelSizeToggleRef_=u.a.createRef(),r.pixelSizeRef_=u.a.createRef(),r.framebufferWidthRef_=u.a.createRef(),r.framebufferHeightRef_=u.a.createRef(),r.importRef_=u.a.createRef(),r}return Object(f.a)(n,[{key:"render",value:function(){var e,t,n,r,i,a=this,s=this.props.displayConfig,o=function(e){return Object(je.jsxs)("label",{children:[Object(je.jsx)("input",{type:"radio",name:"aspect",value:e,onChange:a.setAspectRatio_,checked:e===s.aspect}),e]})};return Object(je.jsxs)("div",{className:"ControlPanel",children:[Object(je.jsx)("button",{className:"Toggle",title:"Options",onClick:this.toggleOptions_,children:"\u2699\ufe0f"}),Object(je.jsx)("button",{className:"Toggle",title:"Toggle Fullscreen",onClick:this.enterFullscreen_,children:"\ud83d\udda5\ufe0f"}),this.state.optionsVisible&&Object(je.jsxs)("div",{className:"OptionsPanel",children:[Object(je.jsx)("h1",{children:"Display Options"}),Object(je.jsx)("h2",{children:"Aspect Ratio"}),o("None"),o("1:1"),o("4:3"),o("16:9"),o("16:10"),Object(je.jsx)("h2",{children:"Resolution"}),Object(je.jsxs)("label",{children:[Object(je.jsx)("input",{type:"radio",name:"resolution",value:"pixel",ref:this.pixelSizeToggleRef_,onChange:this.updateResolution_,checked:"pixel"===s.resolution.mode}),"Fixed Pixel Size",Object(je.jsx)("input",{type:"number",name:"pixelSize",value:null!==(e=s.resolution.pixelSize)&&void 0!==e?e:1,ref:this.pixelSizeRef_,style:{width:"3em",marginLeft:"1em"},onChange:this.updateResolution_})]}),Object(je.jsxs)("label",{children:[Object(je.jsx)("input",{type:"radio",name:"resolution",value:"framebuffer",onChange:this.updateResolution_,checked:"framebuffer"===s.resolution.mode}),"Fixed Framebuffer Size",Object(je.jsx)("input",{type:"text",name:"framebufferWidth",style:{width:"4em",marginLeft:"1em"},ref:this.framebufferWidthRef_,value:null!==(t=null===(n=s.resolution.framebufferSize)||void 0===n?void 0:n.width)&&void 0!==t?t:4,onChange:this.updateResolution_}),"x",Object(je.jsx)("input",{type:"text",name:"framebufferHeight",style:{width:"4em"},ref:this.framebufferHeightRef_,value:null!==(r=null===(i=s.resolution.framebufferSize)||void 0===i?void 0:i.height)&&void 0!==r?r:4,onChange:this.updateResolution_})]}),Object(je.jsx)("h1",{children:"Editor Options"}),Object(je.jsx)(ye,{label:"Theme",children:Object(je.jsx)("select",{value:this.props.codeMirrorTheme,onChange:function(e){return a.props.onCodeMirrorThemeChange(e.currentTarget.value)},children:ge.map((function(e){return Object(je.jsx)("option",{value:e,children:e},e)}))})})]}),Object(je.jsx)("button",{className:"Toggle",onClick:this.saveBlueprint_,title:"Save Blueprint",children:"\ud83d\udcbe"}),Object(je.jsx)("button",{className:"Toggle",onClick:this.toggleLoadBlueprintPanel_,title:"Load Blueprint",children:"\ud83d\udcc2"}),this.state.loadMenuVisible&&Object(je.jsxs)("div",{className:"LoadBlueprintPanel",children:[Object(je.jsx)("h1",{children:"Saved Shaders"}),Object.entries(this.props.savedBlueprints).map((function(e){var t=Object(E.a)(e,2),n=t[0];t[1];return Object(je.jsxs)("div",{className:"LoadMenuItem",children:[Object(je.jsx)("div",{className:"LoadMenuName",onClick:function(){return a.loadBlueprint_(n)},children:n}),Object(je.jsx)("button",{className:"LoadMenuRemove",onClick:function(){return a.deleteBlueprint_(n)},children:"x"})]},n)}))]}),Object(je.jsx)("button",{className:"Toggle",onClick:this.copyBlueprintToClipboard_,title:"Copy Blueprint To Clipboard",children:"\ud83d\udccb"}),Object(je.jsx)("button",{className:"Toggle",onClick:this.togglePasteMenu_,title:"Paste Blueprint From Clipboard",children:"\u2b07"}),this.state.pasteMenuVisible&&Object(je.jsxs)("div",{className:"PasteBlueprintPanel",children:[Object(je.jsx)("h1",{children:"Import From Clipboard"}),"Paste it here:",Object(je.jsx)("textarea",{ref:this.importRef_}),Object(je.jsx)("button",{title:"Import",onClick:this.importBlueprintFromClipboard_,children:"Import"})]})]})}}]),n}(u.a.Component),_e=(n(105),function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).wrapperRef_=void 0,r.canvasRef_=void 0,r.pendingFrameRequest_=void 0,r.wrapperRef_=u.a.createRef(),r.canvasRef_=u.a.createRef(),r.pendingFrameRequest_=null,r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=this;!function t(){var n=e.wrapperRef_.current,r=e.canvasRef_.current,i=n.clientWidth,a=n.clientHeight;r.width===i&&r.height===a||(r.width=i,r.height=a),e.props.render(r),e.pendingFrameRequest_=requestAnimationFrame(t)}()}},{key:"componentWillUnmount",value:function(){null!==this.pendingFrameRequest_&&(cancelAnimationFrame(this.pendingFrameRequest_),this.pendingFrameRequest_=null)}},{key:"render",value:function(){var e=this.props.config.aspect.split(":").map((function(e){return parseInt(e)})),t=Object(E.a)(e,2),n=t[0],r=t[1],i=isNaN(n)||isNaN(r),a={height:i?"100%":"auto",aspectRatio:i?"auto":"".concat(n,"/").concat(r)};return Object(je.jsx)("div",{className:"Display",children:Object(je.jsx)("div",{ref:this.wrapperRef_,className:"CanvasWrapper",style:a,children:Object(je.jsx)("canvas",{ref:this.canvasRef_})})})}}]),n}(u.a.Component)),Oe=(n(106),n(107),n(9)),ke=function(){function e(){Object(h.a)(this,e),this.nextIdMap_=void 0,this.nextIdMap_=new WeakMap}return Object(f.a)(e,[{key:"generateKey",value:function(e,t){var n,r=this.nextIdMap_.get(e);r||(r=new Map,this.nextIdMap_.set(e,r));for(var i=null!==t&&void 0!==t?t:"",a=null!==(n=r.get(i))&&void 0!==n?n:0,s=function(){return"".concat(i).concat(a)};e.hasOwnProperty(s());)++a;return r.set(i,a+1),s()}}]),e}(),Ce=(n(15),function(e){var t=e.data,n=t.node,r=function(e){var r,i;t.onChange({group:Math.max(0,null!==(r=e.group)&&void 0!==r?r:n.group),binding:Math.max(0,null!==(i=e.binding)&&void 0!==i?i:n.binding)})};return Object(je.jsxs)("div",{children:[Object(je.jsx)(Oe.a,{type:"target",position:"top",className:"Handle BindingStub",isConnectable:!1}),Object(je.jsx)(Oe.a,{type:"source",position:"bottom",className:"Handle BindingStub",isConnectable:!1}),Object(je.jsxs)("div",{children:[Object(je.jsxs)("div",{className:"Row",children:["Group",Object(je.jsx)("input",{type:"number",value:n.group,onChange:function(e){return r({group:e.currentTarget.valueAsNumber})}})]}),Object(je.jsxs)("div",{className:"Row",children:["Binding",Object(je.jsx)("input",{type:"number",value:n.binding,onChange:function(e){return r({binding:e.currentTarget.valueAsNumber})}})]})]})]})}),we=(n(108),function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e){var r,i;return Object(h.a)(this,n),(i=t.call(this,e)).onClick_=function(e){!1!==i.props.enabled&&i.setState({isEditing:!0})},i.commit_=function(e){var t=e.trim();""!==t?(i.setState({value:t,isEditing:!1}),i.props.onChange(t)):i.setState({isEditing:!1})},i.onKeyDown_=function(e){"Enter"===e.key?i.commit_(e.currentTarget.value):"Escape"===e.key&&i.setState({isEditing:!1})},i.onFocusOut_=function(e){i.commit_(e.currentTarget.value)},i.state={value:null!==(r=e.value)&&void 0!==r?r:"",isEditing:!1},i}return Object(f.a)(n,[{key:"render",value:function(){var e,t=""===this.state.value,n=this.state.isEditing,r=n?"Editing":"NotEditing",i=t?"Empty":"NotEmpty",a=t?null!==(e=this.props.emptyText)&&void 0!==e?e:"":this.state.value;return Object(je.jsx)("input",{className:"EditableLabel ".concat(r," ").concat(i),type:"text",onKeyDown:this.onKeyDown_,onBlur:this.onFocusOut_,defaultValue:a,readOnly:!n,onClick:this.onClick_,autoFocus:!0})}}]),n}(u.a.Component)),Te=function(e){return Object(je.jsxs)("div",{className:"Node Node-".concat(e.node.type," ").concat(e.className),children:[Object(je.jsx)("button",{className:"RemoveButton",onClick:e.destroy}),Object(je.jsx)("div",{className:"Title",children:e.title}),Object(je.jsxs)("div",{className:"Content",children:[e.onRename?Object(je.jsx)(ye,{label:"Name",children:Object(je.jsx)(we,{value:e.node.name,onChange:e.onRename})}):Object(je.jsx)("div",{}),e.children]})]})};function Se(e,t){if(!e.source||!e.target)return null;var n=t.nodes[e.source],r=t.nodes[e.target];return n&&r&&e.targetHandle?{source:n,target:r,sourceName:e.source,targetName:e.target,targetHandle:e.targetHandle}:null}function Pe(e,t){var n=Se(e,t);return!!n&&(("buffer"===n.source.type||"texture"===n.source.type||"sampler"===n.source.type)&&(("render"===n.target.type||"compute"===n.target.type)&&("bindings"===n.targetHandle&&!Object.values(t.nodes).some((function(e){return"connection"===e.type&&"binding"===e.connectionType&&e.source===n.sourceName&&e.target===n.targetName})))))}function Be(e,t){var n=Se(e,t);return!!n&&(("render"===n.source.type||"compute"===n.source.type)&&(("render"===n.target.type||"compute"===n.target.type)&&!Object.values(t.nodes).some((function(e){return"connection"===e.type&&"queue"===e.connectionType&&e.source===n.sourceName&&e.target===n.targetName}))))}var Ne=function(){function e(t){Object(h.a)(this,e),this.minDelayMs_=void 0,this.lastInvocationMs_=void 0,this.pendingInvocation_=void 0,this.minDelayMs_=t,this.lastInvocationMs_=null,this.pendingInvocation_=null}return Object(f.a)(e,[{key:"invoke",value:function(e){this.onCooldown()?this.scheduleSuppressed(e):this.invokeInternal(e)}},{key:"clearPendingInvocation",value:function(){null!==this.pendingInvocation_&&clearTimeout(this.pendingInvocation_),this.pendingInvocation_=null}},{key:"invokeInternal",value:function(e){this.clearPendingInvocation(),this.lastInvocationMs_=Date.now(),e()}},{key:"onCooldown",value:function(){return null!==this.lastInvocationMs_&&Date.now()-this.lastInvocationMs_<this.minDelayMs_}},{key:"scheduleSuppressed",value:function(e){null!==this.pendingInvocation_&&clearTimeout(this.pendingInvocation_);var t=this.lastInvocationMs_+this.minDelayMs_-Date.now();this.pendingInvocation_=setTimeout(this.invoke.bind(this,e),t)}}]),e}();function Re(e){var t=[e.r,e.g,e.b].map((function(e){return"".concat((t=255*e)<16?"0":"").concat(t.toString(16));var t}));return"#".concat(t.join(""))}function Me(e){var t=function(t){return parseInt(e.slice(t,t+2),16)/255};return{r:t(1),g:t(3),b:t(5),a:1}}function ze(){return(ze=Object(a.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return");case 2:if(r=t.getContext("2d")){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,createImageBitmap(n);case 7:if(a=e.sent){e.next=10;break}return e.abrupt("return");case 10:r.drawImage(a,0,0,a.width,a.height,0,0,128,128);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var De={buffer:function(e){var t=e.data,n=t.node;return Object(je.jsx)(Te,{title:"Buffer",node:n,onRename:function(e){return t.onChange({name:e})},destroy:t.destroy,children:Object(je.jsxs)("div",{children:[Object(je.jsx)(Oe.a,{type:"source",className:"Handle Binding",position:"bottom",isValidConnection:function(e){return Pe(e,t.blueprint)}}),Object(je.jsx)(ye,{label:"Size",children:Object(je.jsx)("input",{type:"number",value:n.size,style:{width:"5em",textAlign:"right"},onChange:function(e){return t.onChange({size:e.currentTarget.valueAsNumber})}})}),Object(je.jsx)(ye,{label:"Init",children:Object(je.jsxs)("select",{value:n.init,style:{width:"9em"},onChange:function(e){return t.onChange({init:e.currentTarget.value})},children:[Object(je.jsx)("option",{value:"zero",children:"Zero"}),Object(je.jsx)("option",{value:"random-floats",children:"Random Floats"}),Object(je.jsx)("option",{value:"random-uints",children:"Random Uints"})]})})]})})},texture:function(e){var t=e.data,n=t.node,r=u.a.useRef(null);return u.a.useEffect((function(){var e=r;e.current&&n.imageData instanceof Blob&&function(e,t){ze.apply(this,arguments)}(e.current,n.imageData)})),Object(je.jsx)(Te,{title:"Texture",node:n,onRename:function(e){return t.onChange({name:e})},destroy:t.destroy,children:Object(je.jsxs)("div",{className:"TextureDetails",children:[Object(je.jsx)(Oe.a,{type:"source",className:"Handle Binding",position:"bottom",isValidConnection:function(e){return Pe(e,t.blueprint)}}),Object(je.jsx)("input",{type:"file",accept:"image/*",onChange:function(e){var n,r=(n=e.currentTarget).files&&0!==n.files.length?n.files[0]:null;r&&t.onChange({imageData:r})}}),Object(je.jsx)("canvas",{id:n.name,ref:r,className:"Preview",width:128,height:128})]})})},compute:function(e){var t,n,r=e.data,i=r.node;return Object(je.jsx)(Te,{title:"Compute Pass",node:i,onRename:function(e){return r.onChange({name:e})},destroy:r.destroy,children:Object(je.jsxs)("div",{children:[Object(je.jsx)(Oe.a,{id:"bindings",type:"target",title:"Bindings",position:"top",className:"Handle Binding",isValidConnection:function(e){return Pe(e,r.blueprint)}}),Object(je.jsx)(Oe.a,{id:"queueIn",type:"target",title:"Queue In",position:"left",className:"Handle Queue",isValidConnection:function(e){return Be(e,r.blueprint)}}),Object(je.jsx)(Oe.a,{id:"queueOut",type:"source",title:"Queue Out",position:"right",className:"Handle Queue",isValidConnection:function(e){return Be(e,r.blueprint)}}),Object(je.jsx)(ye,{label:"Shader",children:Object(je.jsxs)("select",{value:null!==(t=i.shader)&&void 0!==t?t:"",onChange:function(e){return r.onChange({shader:e.currentTarget.value})},children:[Object(je.jsx)("option",{value:""}),Object.entries(r.blueprint.shaders).map((function(e){var t=Object(E.a)(e,2),n=t[0],r=t[1];return Object(je.jsx)("option",{value:n,children:r.name},n)}))]})}),Object(je.jsx)(ye,{label:"Entry Point",children:Object(je.jsx)(we,{emptyText:"None",value:null!==(n=i.entryPoint)&&void 0!==n?n:"",onChange:function(e){return r.onChange({entryPoint:e})}})}),Object(je.jsx)(ye,{label:"Dispatch Size",children:Object(je.jsxs)("div",{className:"DispatchSize",children:[Object(je.jsxs)("div",{className:"DispatchSizeElement",children:["X"," ",Object(je.jsx)("input",{type:"number",value:i.dispatchSize.x,onChange:function(e){return r.onChange({dispatchSize:{x:Math.max(0,e.currentTarget.valueAsNumber),y:i.dispatchSize.y,z:i.dispatchSize.z}})}})]}),Object(je.jsxs)("div",{className:"DispatchSizeElement",children:["Y"," ",Object(je.jsx)("input",{type:"number",value:i.dispatchSize.y,onChange:function(e){return r.onChange({dispatchSize:{x:i.dispatchSize.x,y:Math.max(0,e.currentTarget.valueAsNumber),z:i.dispatchSize.z}})}})]}),Object(je.jsxs)("div",{className:"DispatchSizeElement",children:["Z"," ",Object(je.jsx)("input",{type:"number",value:i.dispatchSize.z,onChange:function(e){return r.onChange({dispatchSize:{x:i.dispatchSize.x,y:i.dispatchSize.y,z:Math.max(0,e.currentTarget.valueAsNumber)}})}})]})]})})]})})},render:function(e){var t,n,r,i,a,s,o,c,u=e.data,l=u.node,d=new Ne(30);return Object(je.jsx)(Te,{title:"Render Pass",node:l,onRename:function(e){return u.onChange({name:e})},destroy:u.destroy,children:Object(je.jsxs)("div",{children:[Object(je.jsx)(Oe.a,{id:"bindings",type:"target",title:"Bindings",position:"top",className:"Handle Binding",isValidConnection:function(e){return Pe(e,u.blueprint)}}),Object(je.jsx)(Oe.a,{id:"queueIn",type:"target",title:"Queue In",position:"left",className:"Handle Queue",isValidConnection:function(e){return Be(e,u.blueprint)}}),Object(je.jsx)(Oe.a,{id:"queueOut",type:"source",title:"Queue Out",position:"right",className:"Handle Queue",isValidConnection:function(e){return Be(e,u.blueprint)}}),Object(je.jsx)(ye,{label:"Vertex Shader",children:Object(je.jsxs)("select",{value:null!==(t=l.vertexShader)&&void 0!==t?t:"",onChange:function(e){return u.onChange({vertexShader:e.currentTarget.value})},children:[Object(je.jsx)("option",{value:""}),Object.entries(u.blueprint.shaders).map((function(e){var t=Object(E.a)(e,2),n=t[0],r=t[1];return Object(je.jsx)("option",{value:n,children:r.name},n)}))]})}),Object(je.jsx)(ye,{label:"Vertex Entry Point",children:Object(je.jsx)(we,{value:null!==(n=l.vertexEntryPoint)&&void 0!==n?n:"",emptyText:"None",onChange:function(e){return u.onChange({vertexEntryPoint:e})}})}),Object(je.jsx)(ye,{label:"Fragment Shader",children:Object(je.jsxs)("select",{value:null!==(r=l.fragmentShader)&&void 0!==r?r:"",onChange:function(e){return u.onChange({fragmentShader:e.currentTarget.value})},children:[Object(je.jsx)("option",{value:""}),Object.entries(u.blueprint.shaders).map((function(e){var t=Object(E.a)(e,2),n=t[0],r=t[1];return Object(je.jsx)("option",{value:n,children:r.name},n)}))]})}),Object(je.jsx)(ye,{label:"Fragment Entry Point",children:Object(je.jsx)(we,{value:null!==(i=l.fragmentEntryPoint)&&void 0!==i?i:"",emptyText:"None",onChange:function(e){return u.onChange({fragmentEntryPoint:e})}})}),Object(je.jsx)(ye,{label:"Topology",children:Object(je.jsxs)("select",{value:null!==(a=l.topology)&&void 0!==a?a:"triangle-list",onChange:function(e){return u.onChange({topology:e.currentTarget.value})},children:[Object(je.jsx)("option",{value:"point-list",children:"Point List"}),Object(je.jsx)("option",{value:"line-list",children:"Line List"}),Object(je.jsx)("option",{value:"line-strip",children:"Line Strip"}),Object(je.jsx)("option",{value:"triangle-list",children:"Triangle List"}),Object(je.jsx)("option",{value:"triangle-strip",children:"Triangle Strip"})]})}),Object(je.jsx)(ye,{label:"# Vertices",children:Object(je.jsx)("input",{type:"number",value:l.numVertices,onChange:function(e){return u.onChange({numVertices:Math.max(e.currentTarget.valueAsNumber,0)})}})}),Object(je.jsx)(ye,{label:"# Instances",children:Object(je.jsx)("input",{type:"number",value:l.numInstances,onChange:function(e){return u.onChange({numInstances:Math.max(e.currentTarget.valueAsNumber,0)})}})}),Object(je.jsx)(ye,{label:"Clear",children:Object(je.jsx)("input",{type:"checkbox",checked:null!==(s=l.clear)&&void 0!==s&&s,onChange:function(e){return u.onChange({clear:!l.clear})}})}),Object(je.jsx)(ye,{label:"Clear Color",children:Object(je.jsx)("input",{type:"color",value:Re(null!==(o=l.clearColor)&&void 0!==o?o:{r:0,g:0,b:0,a:1}),onChange:function(e){return d.invoke((function(){return u.onChange({clearColor:Me(e.currentTarget.value)})}))}})}),Object(je.jsx)(ye,{label:"Depth Test",children:Object(je.jsxs)("select",{value:null!==(c=l.depthTest)&&void 0!==c?c:"always",onChange:function(e){return u.onChange({depthTest:e.currentTarget.value})},children:[Object(je.jsx)("option",{value:"never",children:"Never Pass"}),Object(je.jsx)("option",{value:"less",children:"<"}),Object(je.jsx)("option",{value:"less-equal",children:"<="}),Object(je.jsx)("option",{value:"equal",children:"="}),Object(je.jsx)("option",{value:"greater-equal",children:">="}),Object(je.jsx)("option",{value:"greater",children:">"}),Object(je.jsx)("option",{value:"not-equal",children:"\u2260"}),Object(je.jsx)("option",{value:"always",children:"Always Pass"})]})})]})})},sampler:function(e){var t=e.data,n=t.node;return Object(je.jsx)(Te,{title:"Sampler",node:n,onRename:function(e){return t.onChange({name:e})},destroy:t.destroy,children:Object(je.jsx)("div",{className:"SamplerDetails",children:Object(je.jsx)(Oe.a,{type:"source",className:"Handle Binding",position:"bottom",isValidConnection:function(e){return Pe(e,t.blueprint)}})})})},"buffer-binding":function(e){var t=e.data,n=t.node;return Object(je.jsxs)(Te,{className:"BufferBinding",node:n,destroy:t.destroy,children:[Object(je.jsxs)("select",{value:n.storageType,onChange:function(e){return t.onChange({storageType:e.currentTarget.value})},children:[Object(je.jsx)("option",{value:"storage-read",children:"Storage (r/o)"}),Object(je.jsx)("option",{value:"storage",children:"Storage (r/w)"}),Object(je.jsx)("option",{value:"uniform",children:"Uniform"}),Object(je.jsx)("option",{value:"sampler",children:"Sampler"}),Object(je.jsx)("option",{value:"texture",children:"Texture"})]}),Object(je.jsx)(Ce,{data:t})]})},"sampler-binding":function(e){var t=e.data;return Object(je.jsx)(Te,{title:"",node:t.node,destroy:t.destroy,children:Object(je.jsx)(Ce,{data:t})})},"texture-binding":function(e){var t=e.data;return Object(je.jsx)(Te,{title:"",node:t.node,destroy:t.destroy,children:Object(je.jsx)(Ce,{data:t})})}},Ee={"custom-edge":function(e){var t=e.id,n=e.sourceX,r=e.sourceY,i=e.targetX,a=e.targetY,s=e.sourcePosition,o=e.targetPosition,c=e.style,u=void 0===c?{}:c,l=e.data,d=e.arrowHeadType,p=e.markerEndId,h=Object(Oe.c)({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:a,targetPosition:o}),f=Object(Oe.e)(d,p),b=Object(Oe.d)({sourceX:n,sourceY:r,targetX:i,targetY:a}),v=Object(E.a)(b,2),m=v[0],g=v[1],j=l;return Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)("path",{id:t,style:u,className:"react-flow__edge-path",d:h,markerEnd:f}),j.destroy&&Object(je.jsx)("foreignObject",{width:16,height:16,x:m-8,y:g-8,children:Object(je.jsx)("div",{className:"Edge",children:Object(je.jsx)("button",{className:"RemoveButton",onClick:j.destroy})})})]})}},Ae=function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"componentDidCatch",value:function(e,t){console.log(e)}},{key:"render",value:function(){return this.props.children}}]),n}(u.a.Component),Ve=function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).keyGenerator_=void 0,r.instance_=void 0,r.flowRef_=void 0,r.lastConnectStart_=void 0,r.lastConnectEnd_=void 0,r.onLoad_=function(e){r.instance_=e},r.onConnectStart_=function(e){r.lastConnectStart_={x:e.clientX,y:e.clientY}},r.onConnectStop_=function(e){r.lastConnectEnd_={x:e.clientX,y:e.clientY}},r.onConnect_=function(e){var t=e.source,n=e.target,i=r.props.blueprint.nodes[t],a=r.props.blueprint.nodes[n],s=e.targetHandle;if(i&&a){var o=function(e){var t=e.type;return"render"===t||"compute"===t};if(o(a)){var c=r.instance_,u=r.lastConnectStart_,l=r.lastConnectEnd_,d=r.flowRef_.current,p={x:100,y:100};if(c&&null!==u&&null!==l&&d){var h=d.getBoundingClientRect(),f={x:(u.x+l.x-120)/2-h.x,y:(u.y+l.y-80)/2-h.y};p=c.project(f)}if("buffer"===i.type&&"bindings"===s)r.addBufferBinding_(t,n,p,"storage-read");else{if("texture"===i.type&&"bindings"===s)return void r.addTextureBinding_(t,n,p);if("sampler"===i.type&&"bindings"===s)return void r.addSamplerBinding_(t,n,p);if(o(i)&&"queueIn"===s){var b=r.newNodeKey_("queue-dep");r.updateNode_(b,{id:b,name:"",position:p,type:"connection",connectionType:"queue",source:e.source,target:e.target})}}}}},r.onMoveEnd_=function(e){e&&r.props.onTransformChange(Object(p.a)({},e))},r.onMoveNode_=function(e,t){r.updateNode_(t.data.node.id,{position:Object(p.a)({},t.position)})},r.addShader_=function(){var e=r.newShaderKey_();r.updateBlueprint_({shaders:Object(d.a)({},e,{name:e,id:e,code:""})})},r.addNode_=function(e){var t=r.newNodeKey_(e.type);r.updateNode_(t,Object(p.a)({id:t,name:t,position:{x:100,y:100}},e))},r.addBuffer_=function(){r.addNode_({type:"buffer",size:16384,init:"zero"})},r.addTexture_=function(){r.addNode_({type:"texture",size:{width:1024,height:1024},format:"rgba8unorm",mipLevelCount:1,sampleCount:1,imageData:null})},r.addSampler_=function(){return r.addNode_({type:"sampler"})},r.addBufferBinding_=function(e,t,n,i){r.addNode_({type:"connection",connectionType:"binding",bindingType:"buffer",source:e,target:t,position:n,group:0,binding:1,storageType:i})},r.addTextureBinding_=function(e,t,n){r.addNode_({type:"connection",connectionType:"binding",bindingType:"texture",source:e,target:t,position:n,group:0,binding:1})},r.addSamplerBinding_=function(e,t,n){r.addNode_({type:"connection",connectionType:"binding",bindingType:"sampler",source:e,target:t,position:n,group:0,binding:1})},r.addRenderPass_=function(){r.addNode_({type:"render",vertexShader:null,vertexEntryPoint:null,fragmentShader:null,fragmentEntryPoint:null,topology:"triangle-list",numVertices:4,numInstances:1,indexed:!1,clear:!0,clearColor:{r:0,g:0,b:0,a:1},depthTest:"always"})},r.addComputePass_=function(){r.addNode_({type:"compute",shader:"",entryPoint:"",dispatchSize:{x:1,y:1,z:1}})},r.removeNode_=function(e){for(var t=r.props.blueprint,n=new Set([e]),i=0,a=Object.entries(t.nodes);i<a.length;i++){var s=Object(E.a)(a[i],2),o=s[0],c=s[1];"connection"!==c.type||c.source!==e&&c.target!==e||n.add(o)}for(var u={},l=0,d=Object.entries(t.nodes);l<d.length;l++){var p=Object(E.a)(d[l],2),h=p[0],f=p[1];n.has(h)||(u[h]=V(f))}r.replaceBlueprint_({nodes:u,shaders:t.shaders})},r.keyGenerator_=new ke,r.instance_=null,r.flowRef_=u.a.createRef(),r.lastConnectStart_=null,r.lastConnectEnd_=null,r}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props.transform;return Object(je.jsx)("div",{className:"BlueprintEditor",children:Object(je.jsx)(Ae,{children:Object(je.jsx)(Oe.b,{ref:this.flowRef_,nodeTypes:De,edgeTypes:Ee,elements:this.createGraph_(this.props.blueprint),defaultZoom:e.zoom,defaultPosition:[e.x,e.y],elementsSelectable:!1,nodesConnectable:!0,nodesDraggable:!0,onLoad:this.onLoad_,onConnectStart:this.onConnectStart_,onConnectStop:this.onConnectStop_,onConnect:this.onConnect_,onElementClick:function(){},onMoveEnd:this.onMoveEnd_,onNodeDragStop:this.onMoveNode_,minZoom:.01,maxZoom:4,children:Object(je.jsxs)("div",{className:"Toolbar",children:[Object(je.jsx)("button",{onClick:this.addShader_,children:"+Shader"}),Object(je.jsx)("button",{onClick:this.addBuffer_,children:"+Buffer"}),Object(je.jsx)("button",{onClick:this.addTexture_,children:"+Texture"}),Object(je.jsx)("button",{onClick:this.addSampler_,children:"+Sampler"}),Object(je.jsx)("button",{onClick:this.addRenderPass_,children:"+Render Pass"}),Object(je.jsx)("button",{onClick:this.addComputePass_,children:"+Compute Pass"})]})})})})}},{key:"newKey_",value:function(e,t){return this.keyGenerator_.generateKey(e,t)}},{key:"newNodeKey_",value:function(e){return this.newKey_(this.props.blueprint.nodes,e)}},{key:"newShaderKey_",value:function(){return this.newKey_(this.props.blueprint.shaders,"shader")}},{key:"replaceBlueprint_",value:function(e){this.props.onChange(e)}},{key:"updateBlueprint_",value:function(e){var t=V(this.props.blueprint);L(t,e),this.replaceBlueprint_(t)}},{key:"updateNode_",value:function(e,t){this.updateBlueprint_({nodes:Object(d.a)({},e,t)})}},{key:"createGraph_",value:function(e){var t=this,n=[];return Object.entries(e.nodes).forEach((function(r){var i=Object(E.a)(r,2),a=i[0],s=i[1],o={blueprint:e,node:s,onChange:function(e){return t.updateNode_(a,e)},destroy:function(){return t.removeNode_(a)}},c=s.position;if("connection"!==s.type)n.push({id:a,type:s.type,position:c,data:o});else if("binding"===s.connectionType){var u="".concat(s.bindingType,"-binding"),l="".concat(a,"-node"),d="".concat(a,"-source-edge"),p="".concat(a,"-target-edge");n.push({id:l,type:u,position:c,data:o}),n.push({id:d,source:s.source,target:l}),n.push({id:p,source:l,target:s.target,arrowHeadType:"arrowclosed"})}else"queue"===s.connectionType&&n.push({id:a,source:s.source,target:s.target,targetHandle:"queueIn",type:"custom-edge",arrowHeadType:"arrowclosed",data:o})})),n}}]),n}(u.a.Component),Ue=(n(109),n(110),n(26)),qe=function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).isDecorating_=void 0,r.editorRef_=void 0,r.onChange_=function(e,t){r.props.onChange(e.getValue())},r.onUpdate_=function(e){var t;if(!r.isDecorating_){r.isDecorating_=!0,e.getAllMarks().forEach((function(e){return e.clear()})),e.clearGutter("GutterMessages");var n,i=Object(m.a)(null!==(t=r.props.compilationMessages)&&void 0!==t?t:[]);try{for(i.s();!(n=i.n()).done;){var a=n.value,s="MarkedText-".concat(a.type),o=a.lineNum;e.markText({line:o,ch:a.linePos-1},{line:o,ch:a.linePos+a.length-1},{className:s});var c=document.createElement("div");c.classList.add("Marker","Marker-".concat(a.type)),e.setGutterMarker(o,"GutterMessages",c)}}catch(u){i.e(u)}finally{i.f()}r.isDecorating_=!1}},r.isDecorating_=!1,r.editorRef_=u.a.createRef(),r}return Object(f.a)(n,[{key:"shouldComponentUpdate",value:function(e){return e.theme!==this.props.theme}},{key:"refresh",value:function(){var e=this.editorRef_.current;e&&e.editor.refresh()}},{key:"render",value:function(){return Object(je.jsx)("div",{className:"CodeEditor",children:Object(je.jsx)(Ue.a,{ref:this.editorRef_,value:this.props.contents,onChange:this.onChange_,onUpdate:this.onUpdate_,options:{theme:this.props.theme,keyMap:"sublime",mode:"rust",gutters:["GutterMessages"],readOnly:!this.props.mutable}})})}}]),n}(u.a.Component),Ie=(n(121),function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={activeTab:0},r}return Object(f.a)(n,[{key:"componentDidUpdate",value:function(){var e=u.a.Children.count(this.props.children);if(this.state.activeTab>=e)this.setState({activeTab:e-1});else{var t=this.props.tabs[this.state.activeTab];t.onActivate&&t.onActivate()}}},{key:"render",value:function(){var e=this;return Object(je.jsxs)("div",{className:"TabContainer",children:[this.renderTabs_(),Object(je.jsx)("div",{className:"ContentArea",children:u.a.Children.toArray(this.props.children).map((function(t,n){var r=n===e.state.activeTab;return Object(je.jsx)("div",{className:"Content ".concat(r?"Active":"Inactive"),children:t},n)}))})]})}},{key:"renderTabs_",value:function(){var e=this;return Object(je.jsx)("div",{className:"TabStrip",children:this.props.tabs.map((function(t,n){var r,i=e.state.activeTab===n;return Object(je.jsxs)("div",{className:"".concat(i?"Tab Active":"Tab Inactive","\n                          ").concat(t.mutable?"Removable":"Permanent"),onClick:function(t){return e.setActiveTab_(n)},children:[Object(je.jsx)(we,{enabled:t.mutable&&i,value:t.title,onChange:null!==(r=t.onRename)&&void 0!==r?r:function(){return{}}}),t.mutable&&Object(je.jsx)("button",{className:"RemoveButton",onClick:function(e){t.onClose&&t.onClose(),e.stopPropagation()}})]},t.key+t.title)}))})}},{key:"setActiveTab_",value:function(e){this.setState({activeTab:e})}}]),n}(u.a.Component)),Le=function(e){var t=function(e){e.current&&e.current.refresh()},n=Object.entries(e.blueprint.shaders),r=u.a.createRef(),i=n.map((function(){return u.a.createRef()}));return Object(je.jsx)("div",{className:"Editor",children:Object(je.jsxs)(Ie,{tabs:[{key:"Blueprint",title:"Blueprint",mutable:!1},{key:"Uniforms",title:"Uniforms",mutable:!1,onActivate:function(){t(r)}}].concat(Object(se.a)(n.map((function(n,r){var a=Object(E.a)(n,2),s=a[0],o=a[1];return{key:s,title:o.name,mutable:!0,onActivate:function(){t(i[r])},onClose:function(){return function(t){var n=V(e.blueprint);delete n.shaders[t],e.onBlueprintChange(n)}(s)},onRename:function(t){return function(t,n){var r=V(e.blueprint);r.shaders[t].name=n,e.onBlueprintChange(r)}(s,t)}}})))),children:[Object(je.jsx)(Ve,{blueprint:e.blueprint,transform:e.viewTransform,onChange:e.onBlueprintChange,onTransformChange:e.onViewTransformChange}),Object(je.jsx)(qe,{ref:r,contents:J,mutable:!1,onChange:function(){return{}},theme:e.codeMirrorTheme},"Uniforms"),n.map((function(t,n){var r=Object(E.a)(t,2),a=r[0],s=r[1];return Object(je.jsx)(qe,{ref:i[n],compilationMessages:e.compilationResults.get(s.id),contents:s.code,mutable:!0,onChange:function(t){var n=V(e.blueprint);n.shaders[a].code=t,e.onBlueprintChange(n)},theme:e.codeMirrorTheme},a)}))]})})},Fe=function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).frameProducer_=void 0,r.onDisplayConfigChange=function(e){r.setState((function(t){return{displayConfig:Object.assign(Object(p.a)({},t.displayConfig),e)}}))},r.onBlueprintChange_=function(e){r.setState({blueprint:e})},r.onViewTransformChange_=function(e){r.setState({editorViewTransform:e})},r.onShadersCompiled_=function(e){r.setState({compilationResults:e})},r.onSaveBlueprint_=function(){var e=Object(a.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(r.state.blueprint);case 2:n=e.sent,r.setState((function(e){return{savedBlueprints:Object(p.a)(Object(p.a)({},e.savedBlueprints),{},Object(d.a)({},t,n))}}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.onLoadBlueprint_=function(){var e=Object(a.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.state.savedBlueprints[t]){e.next=3;break}return e.abrupt("return");case 3:r.onBlueprintChange_(_(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.onImportBlueprint_=function(e){r.onBlueprintChange_(_(e))},r.onDeleteBlueprint_=function(e){r.setState((function(t){return delete t.savedBlueprints[e],{savedBlueprints:t.savedBlueprints}}))},r.onCodeMirrorThemeChange_=function(e){r.setState({codeMirrorTheme:e})},r.state={blueprint:_(r.data.blueprint),savedBlueprints:r.data.savedBlueprints,displayConfig:r.data.displayConfig,codeMirrorTheme:r.data.codeMirrorTheme,editorViewTransform:r.data.editorViewTransform,compilationResults:new Map},r.frameProducer_=new me,r.frameProducer_.setBlueprint(r.state.blueprint),r}return Object(f.a)(n,[{key:"data",get:function(){return this.props.data.value}},{key:"updateData_",value:function(e){var t=this.props.data.value;Object.assign(t,e),this.props.data.value=t}},{key:"componentDidMount",value:function(){this.frameProducer_.onShadersCompiled=this.onShadersCompiled_}},{key:"componentDidUpdate",value:function(){var e=Object(a.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.blueprint,this.frameProducer_.setBlueprint(t),e.t0=this,e.next=5,z(t);case 5:e.t1=e.sent,e.t2=this.state.savedBlueprints,e.t3=this.state.displayConfig,e.t4=this.state.codeMirrorTheme,e.t5=this.state.editorViewTransform,e.t6={blueprint:e.t1,savedBlueprints:e.t2,displayConfig:e.t3,codeMirrorTheme:e.t4,editorViewTransform:e.t5},e.t0.updateData_.call(e.t0,e.t6);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.frameProducer_.stop()}},{key:"render",value:function(){var e=this;return Object(je.jsxs)("div",{className:"App",children:[Object(je.jsx)("div",{className:"App-header",children:Object(je.jsx)("div",{className:"App-title",children:"WebGPU Playground"})}),Object(je.jsxs)("div",{className:"App-top",children:[Object(je.jsx)("div",{className:"App-canvas",children:Object(je.jsx)(_e,{render:function(t){var n,r=e.state.displayConfig;if("pixel"===r.resolution.mode){var i=r.resolution.pixelSize>=1?r.resolution.pixelSize:1;n={width:t.clientWidth/i,height:t.clientHeight/i}}else n=Object(p.a)({},r.resolution.framebufferSize);e.frameProducer_.render(t,n)},config:this.state.displayConfig})}),Object(je.jsx)("div",{className:"App-editor",children:Object(je.jsx)(Le,{compilationResults:this.state.compilationResults,blueprint:this.state.blueprint,onBlueprintChange:this.onBlueprintChange_,codeMirrorTheme:this.state.codeMirrorTheme,viewTransform:this.state.editorViewTransform,onViewTransformChange:this.onViewTransformChange_})})]}),Object(je.jsx)("div",{className:"App-bottom",children:Object(je.jsx)(xe,{blueprint:this.state.blueprint,displayConfig:this.state.displayConfig,onDisplayConfigChange:this.onDisplayConfigChange,savedBlueprints:this.state.savedBlueprints,onSaveBlueprint:this.onSaveBlueprint_,onLoadBlueprint:this.onLoadBlueprint_,onImportBlueprint:this.onImportBlueprint_,onDeleteBlueprint:this.onDeleteBlueprint_,codeMirrorTheme:this.state.codeMirrorTheme,onCodeMirrorThemeChange:this.onCodeMirrorThemeChange_})})]})}}]),n}(u.a.Component),Ge={blueprint:{version:1,nodes:[],shaders:[]},savedBlueprints:{Basic:{version:1,nodes:[{id:"render1",name:"render quad",position:{x:100,y:100},type:"render",indexed:!1,numVertices:6,numInstances:1,vertexShader:"vertex1",vertexEntryPoint:"main",fragmentShader:"fragment1",fragmentEntryPoint:"main"}],shaders:[{id:"vertex1",name:"Vertex",code:"[[stage(vertex)]]\nfn main([[builtin(vertex_index)]] index: u32)\n    -> [[builtin(position)]] vec4<f32> {\n  let x = select(-1.0, 1.0, index >= 1u && index <= 3u);\n  let y = select(-1.0, 1.0, index >= 2u && index <= 4u);\n  return vec4<f32>(x, y, 0.0, 1.0);\n}\n"},{id:"fragment1",name:"Fragment",code:"[[stage(fragment)]]\nfn main([[builtin(position)]] coord: vec4<f32>)\n    -> [[location(0)]] vec4<f32> {\n  let uv = coord.xy / vec2<f32>(builtinUniforms.resolution.xy);\n  let col = 0.5 + 0.5 * cos(builtinUniforms.time + uv.xyx +\n                            vec3<f32>(0.0, 20.0, 40.0));\n  return vec4<f32>(col, 1.0);\n}\n"}]},Boids:{version:1,nodes:[{id:"compute1",name:"first update",type:"compute",position:{x:223,y:438},shader:"compute1",entryPoint:"main",dispatchSize:{x:2e3,y:1,z:1}},{id:"buffer1",name:"buffer1",type:"buffer",position:{x:-55,y:-35},size:32e3,init:"random-floats"},{id:"buffer2",name:"buffer2",type:"buffer",position:{x:610,y:19},size:32e3,init:"zero"},{id:"render1",name:"render boids",position:{x:-262,y:374},type:"render",indexed:!1,numVertices:3,numInstances:1e3,vertexShader:"vertex1",vertexEntryPoint:"main",fragmentShader:"fragment1",fragmentEntryPoint:"main"},{id:"compute2",name:"update B",type:"compute",position:{x:658,y:442},shader:"compute1",entryPoint:"main",dispatchSize:{x:1e3,y:1,z:1}},{id:"binding1a",name:"",position:{x:65,y:210},type:"connection",connectionType:"binding",bindingType:"buffer",storageType:"storage-read",group:0,binding:1,source:"buffer1",target:"compute1"},{id:"binding1b",name:"",position:{x:-191,y:140},type:"connection",connectionType:"binding",bindingType:"buffer",storageType:"storage-read",group:0,binding:1,source:"buffer1",target:"render1"},{id:"binding2",name:"",position:{x:220,y:218},type:"connection",connectionType:"binding",bindingType:"buffer",storageType:"storage",group:0,binding:2,source:"buffer1",target:"compute2"},{id:"binding3",name:"",position:{x:713,y:179},type:"connection",connectionType:"binding",bindingType:"buffer",storageType:"storage-read",group:0,binding:1,source:"buffer2",target:"compute2"},{id:"binding4",name:"",position:{x:566,y:181},type:"connection",connectionType:"binding",bindingType:"buffer",storageType:"storage",group:0,binding:2,source:"buffer2",target:"compute1"},{id:"queue1",name:"",position:{x:100,y:100},source:"render1",target:"compute1",type:"connection",connectionType:"queue"},{id:"queue2",name:"",position:{x:100,y:100},source:"compute1",target:"compute2",type:"connection",connectionType:"queue"}],shaders:[{id:"compute1",name:"compute",code:"let kRule1Distance = 0.1;\nlet kRule2Distance = 0.025;\nlet kRule3Distance = 0.025;\nlet kRule1Scale = 0.02;\nlet kRule2Scale = 0.05;\nlet kRule3Scale = 0.005;\nlet kNumParticles = 2000u;\n\nstruct Particle {\n  pos: vec2<f32>;\n  vel: vec2<f32>;\n};\n\n[[block]] struct Particles {\n  particles: array<Particle>;\n};\n\n[[group(0), binding(1)]] var<storage, read> particlesA: Particles;\n[[group(0), binding(2)]] var<storage, read_write> particlesB: Particles;\n\n[[stage(compute), workgroup_size(1)]]\nfn main([[builtin(global_invocation_id)]] id: vec3<u32>) {\n  let index = id.x;\n  if (index >= kNumParticles) {\n    return;\n  }\n\n  var vPos = particlesA.particles[index].pos;\n  var vVel = particlesA.particles[index].vel;\n  var cMass = vec2<f32>(0.0, 0.0);\n  var cVel = vec2<f32>(0.0, 0.0);\n  var colVel = vec2<f32>(0.0, 0.0);\n  var cMassCount = 0u;\n  var cVelCount = 0u;\n  var pos: vec2<f32>;\n  var vel: vec2<f32>;\n\n  for (var i = 0u; i < kNumParticles; i = i + 1u) {\n    if (i == index) {\n      continue;\n    }\n    pos = particlesA.particles[i].pos.xy;\n    vel = particlesA.particles[i].vel.xy;\n    if (distance(pos, vPos) < kRule1Distance) {\n      cMass = cMass + pos;\n      cMassCount = cMassCount + 1u;\n    }\n    if (distance(pos, vPos) < kRule2Distance) {\n      colVel = colVel - (pos - vPos);\n    }\n    if (distance(pos, vPos) < kRule3Distance) {\n      cVel = cVel + vel;\n      cVelCount = cVelCount + 1u;\n    }\n  }\n\n  if (cMassCount > 0u) {\n    cMass = (cMass / vec2<f32>(f32(cMassCount), f32(cMassCount))) - vPos;\n  }\n\n  if (cVelCount > 0u) {\n    cVel = cVel / vec2<f32>(f32(cVelCount), f32(cVelCount));\n  }\n\n  vVel = vVel + (cMass * kRule1Scale) + (colVel * kRule2Scale) +\n      (cVel * kRule3Scale);\n\n  vVel = normalize(vVel) * clamp(length(vVel), 0.0, 1.0);\n  vPos = vPos + (vVel * builtinUniforms.timeDelta * 0.25);\n\n  if (vPos.x < -1.0) {\n    vPos.x = vPos.x + 2.0;\n  }\n  if (vPos.x > 1.0) {\n    vPos.x = vPos.x - 2.0;\n  }\n  if (vPos.y < -1.0) {\n    vPos.y = vPos.y + 2.0;\n  }\n  if (vPos.y > 1.0) {\n    vPos.y = vPos.y - 2.0;\n  }\n\n  particlesB.particles[index].pos = vPos;\n  particlesB.particles[index].vel = vVel;\n}\n"},{id:"vertex1",name:"vertex",code:"struct Particle {\n  particlePos: vec2<f32>;\n  particleVel: vec2<f32>;\n};\n\n[[block]] struct Particles {\n  particles: array<Particle>;\n};\n\n[[group(0), binding(1)]] var<storage, read> particles: Particles;\n\nfn getPos(vid: u32) -> vec2<f32> {\n  return select(\n      vec2<f32>(-0.01, -0.02),\n      select(vec2<f32>(0.01, -0.02), vec2<f32>(0.00, 0.02), vid >= 2u),\n      vid >= 1u);\n}\n\n[[stage(vertex)]]\nfn main([[builtin(vertex_index)]] vid: u32,\n        [[builtin(instance_index)]] id: u32)\n    -> [[builtin(position)]] vec4<f32> {\n  let angle = -atan2(particles.particles[id].particleVel.x, particles.particles[id].particleVel.y);\n  let ppos = getPos(vid);\n  let pos = vec2<f32>(ppos.x * cos(angle) - ppos.y * sin(angle),\n                      ppos.x * sin(angle) + ppos.y * cos(angle));\n  return vec4<f32>(pos + particles.particles[id].particlePos, 0.0, 1.0);\n}\n"},{id:"fragment1",name:"fragment",code:"[[stage(fragment)]]\nfn main() -> [[location(0)]] vec4<f32> {\n  return vec4<f32>(0.0, 1.0, 0.0, 1.0);\n}\n"}]},Instances:{version:1,nodes:[{id:"render1",name:"render quad",position:{x:100,y:100},type:"render",indexed:!1,numVertices:6,numInstances:30,vertexShader:"vertex1",vertexEntryPoint:"main",fragmentShader:"fragment1",fragmentEntryPoint:"main"}],shaders:[{id:"vertex1",name:"Vertex",code:"[[stage(vertex)]]\nfn main([[builtin(vertex_index)]] index: u32,\n        [[builtin(instance_index)]] instance: u32)\n    -> [[builtin(position)]] vec4<f32> {\n  let t = builtinUniforms.time * 6.283 / 2.0;\n  let b = 1.0 + f32(instance / 10u) * 0.5;\n  let k = 0.5 + cos(t * 3.0) * 0.2;\n  let c = k * cos(t);\n  let s = k * sin(t);\n  let xo = cos(f32(instance) * 6.283 / 10.0) * 0.5 * b;\n  let yo = sin(f32(instance) * 6.283 / 10.0) * 0.5 * b;\n  let x = select(-1.0, 1.0, index >= 1u && index <= 3u) * 0.3;\n  let y = select(-1.0, 1.0, index >= 2u && index <= 4u) * 0.3;\n  return vec4<f32>(x * c - y * s + xo, x * s + y * c + yo, 0.0, 1.0);\n}\n"},{id:"fragment1",name:"Fragment",code:"[[stage(fragment)]]\nfn main([[builtin(position)]] coord: vec4<f32>)\n    -> [[location(0)]] vec4<f32> {\n  let uv = coord.xy / vec2<f32>(builtinUniforms.resolution.xy);\n  let col = 0.5 + 0.5 * cos(builtinUniforms.time + uv.xyx + vec3<f32>(0.0, 20.0, 40.0));\n  return vec4<f32>(col, 1.0);\n}\n"}]}},displayConfig:{aspect:"1:1",resolution:{mode:"pixel",pixelSize:1}},codeMirrorTheme:"paraiso-dark",editorViewTransform:{x:0,y:0,zoom:1}},He=function(){function e(t,n,r){Object(h.a)(this,e),this.key_=void 0,this.cachedValue_=void 0,this.debouncer_=void 0,this.key_=t,this.cachedValue_=n,this.debouncer_=new Ne(r)}return Object(f.a)(e,[{key:"value",get:function(){return this.cachedValue_},set:function(e){var t=this;this.cachedValue_=e,this.debouncer_.invoke((function(){return o.a.setItem(t.key_,e)}))}}]),e}();function Ke(e){var t,n=localStorage[e],r=null;n&&(r=null!==(t=JSON.parse(n))&&void 0!==t?t:null);return null!==r?r:null}function We(e){return Xe.apply(this,arguments)}function Xe(){return(Xe=Object(a.a)(i.a.mark((function e(t){var n,r,a,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.a.getItem(t.key),a=Ke(t.key),e.next=4,r;case 4:return s=e.sent,c=null,c=null!==s?s:null!==a&&void 0!==a?a:{},e.abrupt("return",new He(t.key,L(V(t.default),c),null!==(n=t.debounceMs)&&void 0!==n?n:100));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(){return(Ye=Object(a.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We({key:"gpu-app-state",default:Ge});case 2:t=e.sent,Object(l.render)(Object(je.jsx)(u.a.StrictMode,{children:Object(je.jsx)(Fe,{data:t})}),document.getElementById("root"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o.a.config({driver:o.a.INDEXEDDB,name:"shady",version:1,storeName:"local_state"}),function(){Ye.apply(this,arguments)}()},15:function(e,t,n){},30:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){}},[[122,7,8]]]);
//# sourceMappingURL=main.c1d6f9a5.chunk.js.map