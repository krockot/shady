(this.webpackJsonpshady=this.webpackJsonpshady||[]).push([[6],{102:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){},119:function(e,t,n){var r={"./apl/apl.js":[138,30],"./asciiarmor/asciiarmor.js":[139,31],"./asn.1/asn.1.js":[140,32],"./asterisk/asterisk.js":[141,33],"./brainfuck/brainfuck.js":[142,34],"./clike/clike.js":[127,2],"./clojure/clojure.js":[143,35],"./cmake/cmake.js":[144,36],"./cobol/cobol.js":[145,37],"./coffeescript/coffeescript.js":[128,38],"./commonlisp/commonlisp.js":[146,39],"./crystal/crystal.js":[147,40],"./css/css.js":[124,1],"./cypher/cypher.js":[148,41],"./d/d.js":[149,42],"./dart/dart.js":[150,2,43],"./diff/diff.js":[151,44],"./django/django.js":[152,0,1,11],"./dockerfile/dockerfile.js":[153,21],"./dtd/dtd.js":[154,45],"./dylan/dylan.js":[155,46],"./ebnf/ebnf.js":[156,47],"./ecl/ecl.js":[157,48],"./eiffel/eiffel.js":[158,49],"./elm/elm.js":[159,50],"./erlang/erlang.js":[160,51],"./factor/factor.js":[161,22],"./fcl/fcl.js":[162,52],"./forth/forth.js":[163,53],"./fortran/fortran.js":[164,54],"./gas/gas.js":[165,55],"./gfm/gfm.js":[166,4,20],"./gherkin/gherkin.js":[167,56],"./go/go.js":[168,57],"./groovy/groovy.js":[169,58],"./haml/haml.js":[170,0,1,14],"./handlebars/handlebars.js":[129,16],"./haskell-literate/haskell-literate.js":[171,26],"./haskell/haskell.js":[130,59],"./haxe/haxe.js":[172,60],"./htmlembedded/htmlembedded.js":[173,0,1,10],"./htmlmixed/htmlmixed.js":[123,0,1,27],"./http/http.js":[174,61],"./idl/idl.js":[175,62],"./javascript/javascript.js":[125,0],"./jinja2/jinja2.js":[176,63],"./jsx/jsx.js":[177,0,28],"./julia/julia.js":[178,64],"./livescript/livescript.js":[179,65],"./lua/lua.js":[180,66],"./markdown/markdown.js":[135,4],"./mathematica/mathematica.js":[181,67],"./mbox/mbox.js":[182,68],"./meta.js":[23],"./mirc/mirc.js":[183,69],"./mllike/mllike.js":[184,70],"./modelica/modelica.js":[185,71],"./mscgen/mscgen.js":[186,72],"./mumps/mumps.js":[187,73],"./nginx/nginx.js":[188,74],"./nsis/nsis.js":[189,23],"./ntriples/ntriples.js":[190,75],"./octave/octave.js":[191,76],"./oz/oz.js":[192,77],"./pascal/pascal.js":[193,78],"./pegjs/pegjs.js":[194,0,79],"./perl/perl.js":[195,80],"./php/php.js":[196,0,1,2,17],"./pig/pig.js":[197,81],"./powershell/powershell.js":[198,82],"./properties/properties.js":[199,83],"./protobuf/protobuf.js":[200,84],"./pug/pug.js":[136,0,1,3],"./puppet/puppet.js":[201,85],"./python/python.js":[131,86],"./q/q.js":[202,87],"./r/r.js":[203,88],"./rpm/rpm.js":[204,89],"./rst/rst.js":[205,13],"./ruby/ruby.js":[126,90],"./rust/rust.js":[206,24],"./sas/sas.js":[207,91],"./sass/sass.js":[133,1,92],"./scheme/scheme.js":[208,93],"./shell/shell.js":[209,94],"./sieve/sieve.js":[210,95],"./slim/slim.js":[211,0,1,15],"./smalltalk/smalltalk.js":[212,96],"./smarty/smarty.js":[213,97],"./solr/solr.js":[214,98],"./soy/soy.js":[215,0,1,18],"./sparql/sparql.js":[216,99],"./spreadsheet/spreadsheet.js":[217,100],"./sql/sql.js":[218,101],"./stex/stex.js":[132,102],"./stylus/stylus.js":[137,5],"./swift/swift.js":[219,103],"./tcl/tcl.js":[220,104],"./textile/textile.js":[221,105],"./tiddlywiki/tiddlywiki.js":[222,106],"./tiki/tiki.js":[223,107],"./toml/toml.js":[224,108],"./tornado/tornado.js":[225,0,1,12],"./troff/troff.js":[226,109],"./ttcn-cfg/ttcn-cfg.js":[228,110],"./ttcn/ttcn.js":[227,111],"./turtle/turtle.js":[229,112],"./twig/twig.js":[230,19],"./vb/vb.js":[231,113],"./vbscript/vbscript.js":[232,114],"./velocity/velocity.js":[233,115],"./verilog/verilog.js":[234,116],"./vhdl/vhdl.js":[235,117],"./vue/vue.js":[236,0,1,5,3,9],"./wast/wast.js":[237,25],"./webidl/webidl.js":[238,118],"./xml/xml.js":[122,119],"./xquery/xquery.js":[239,120],"./yacas/yacas.js":[240,121],"./yaml-frontmatter/yaml-frontmatter.js":[241,29],"./yaml/yaml.js":[134,122],"./z80/z80.js":[242,123]};function i(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n.t(i,7)}))}i.keys=function(){return Object.keys(r)},i.id=119,e.exports=i},120:function(e,t,n){},121:function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r),a=n(9),s=(n(29),n(17)),o=n.n(s),c=n(0),u=n.n(c),l=n(18),d=n(13),p=n(10),h=n(4),f=n(5),b=n(8),g=n(7),v=(n(35),n(2));function m(e,t){if(Array.isArray(e)){if(t.has(e))throw new Error("cycle detected in deep copy");return t.add(e),e.map((function(e){return m(e,t)}))}if(e instanceof Blob)return e;if("object"===typeof e&&null!==e){if(t.has(e))throw new Error("cycle detected in deep copy");t.add(e);for(var n={},r=0,i=Object.entries(e);r<i.length;r++){var a=Object(v.a)(i[r],2),s=a[0],o=a[1];n[s]=m(o,t)}return n}if(null===e||void 0===e)return e;if("number"===typeof e||"string"===typeof e||"boolean"===typeof e)return e;throw new Error("value not deep-copyable")}function j(e){return m(e,new Set)}function x(e,t){return Array.isArray(e)?!(!Array.isArray(t)||e.length!==t.length)&&e.every((function(e,n){return x(e,t[n])})):e instanceof Blob||t instanceof Blob?e===t:"object"===typeof e&&null!==e?"object"===typeof t&&null!==t&&(Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((function(n){return x(e[n],t[n])}))):e===t}var y=n(14),_=n(11),O="// All shader sources are prefixed with the definitions below, providing a\n// set of builtin uniform inputs which are updated by the application before\n// each frame iteration.\n[[block]] struct BuiltinUniforms {\n  // The time in seconds since the application loaded.\n  time: f32;\n\n  // The time in seconds since the last frame iteration. Zero for the first\n  // frame.\n  timeDelta: f32;\n\n  // The count of the current frame. The first frame is frame 0.\n  frame: u32;\n\n  // The resolution in pixels of the main output texture displayed by the app.\n  [[align(16)]] resolution: vec2<u32>;\n};\n\n// All builtin uniforms are accessible to all shaders through this global.\n[[group(0), binding(0)]] var<uniform> builtinUniforms: BuiltinUniforms;\n",C=function(){function e(t,n,r,i){Object(h.a)(this,e),this.gpu_=void 0,this.blueprint_=void 0,this.shaders_=void 0,this.shaderInfo_=void 0,this.builtinUniforms_=void 0,this.buffers_=void 0,this.textures_=void 0,this.passes_=void 0,this.outputDepthStencilTexture_=void 0,this.outputDepthStencilTextureSize_=void 0,this.gpu_=t,this.blueprint_=n,this.shaders_=r,this.shaderInfo_=i,this.builtinUniforms_=null,this.buffers_={},this.textures_={},this.passes_=[],this.outputDepthStencilTexture_=null,this.outputDepthStencilTextureSize_={width:0,height:0}}return Object(f.a)(e,[{key:"gpu",get:function(){return this.gpu_}},{key:"compile_",value:function(){var e=Object(a.a)(i.a.mark((function e(t){var n,r,a,s,o,c,u,l,d,p,h,f,b,g,m,j,x,O,C,k,w,T,S,P,N,R,B,A,E,D,z,M,I,U,q,V,F,G,L,H,X,W,Q,Y,J,K,Z,$,ee,te,ne,re,ie,ae,se,oe,ce,ue,le,de,pe,he,fe,be=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.gpu_.isAcquired){e.next=2;break}return e.abrupt("return",["GPU has been lost"]);case 2:a=[],s=this.gpu_.device,o={},c={},Object.entries(null!==(n=this.blueprint_.edges)&&void 0!==n?n:{}).forEach((function(e){var t=Object(v.a)(e,2),n=(t[0],t[1]);if("binding"===n.type)switch(n.bindingType){case"buffer":o[n.target]||(o[n.target]=[]),o[n.target].push(n);break;case"texture":c[n.target]||(c[n.target]=[]),c[n.target].push(n)}})),u={},l={},d=function(e,t){var n,r,i,a=Object(_.a)(null!==(n=o[e])&&void 0!==n?n:[]);try{for(a.s();!(i=a.n()).done;){var s,d,p=i.value,h=p,f=0,b={binding:h.binding,visibility:t},g=null!==(s=u[e])&&void 0!==s?s:[];u[e]=g;var v,m=h.group,j=null!==(d=g[m])&&void 0!==d?d:{layout:[],bindings:new Map};switch(g[m]=j,j.layout.push(b),j.bindings.set(h.binding,p.source),h.storageType){case"storage-read":f=GPUBufferUsage.STORAGE,b.buffer={type:"read-only-storage"};break;case"storage":f=GPUBufferUsage.STORAGE,b.buffer={type:"storage"};break;case"uniform":f=GPUBufferUsage.UNIFORM,b.buffer={type:"uniform"}}if(0!==f)l[p.source]=(null!==(v=l[p.source])&&void 0!==v?v:0)|f}}catch(R){a.e(R)}finally{a.f()}var x,y=Object(_.a)(null!==(r=c[e])&&void 0!==r?r:[]);try{for(y.s();!(x=y.n()).done;){var O,C,k=x.value,w=k,T={binding:w.binding,visibility:t},S=null!==(O=u[e])&&void 0!==O?O:[];u[e]=S;var P=w.group,N=null!==(C=S[P])&&void 0!==C?C:{layout:[],bindings:new Map};S[P]=N,N.layout.push(T),N.bindings.set(w.binding,k.source),T.texture={}}}catch(R){y.e(R)}finally{y.f()}},p={},h={},f={},b={},g=0,m=Object.entries(this.blueprint_.nodes);case 15:if(!(g<m.length)){e.next=33;break}j=Object(v.a)(m[g],2),x=j[0],O=j[1],e.t0=O.type,e.next="buffer"===e.t0?20:"texture"===e.t0?22:"render"===e.t0?24:"compute"===e.t0?27:30;break;case 20:return p[x]=O,e.abrupt("break",30);case 22:return h[x]=O,e.abrupt("break",30);case 24:return f[x]=O,d(x,GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT),e.abrupt("break",30);case 27:return b[x]=O,d(x,GPUShaderStage.COMPUTE),e.abrupt("break",30);case 30:g++,e.next=15;break;case 33:this.builtinUniforms_=s.createBuffer({size:24,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),C=0,k=Object.entries(p);case 35:if(!(C<k.length)){e.next=47;break}if(w=Object(v.a)(k[C],2),T=w[0],S=w[1],l[T]){e.next=40;break}return e.abrupt("continue",44);case 40:P="zero"!==S.init,N=s.createBuffer({size:S.size,usage:l[T],mappedAtCreation:P}),P&&(R=N.getMappedRange(0,S.size),"random-floats"===S.init?function(){var e=new Uint32Array(S.size/4);crypto.getRandomValues(e);var t=new Float32Array(R);e.forEach((function(e,n){return t[n]=e/Math.pow(2,31)-1}))}():"random-uints"===S.init&&(B=new Uint32Array(R),crypto.getRandomValues(B)),N.unmap()),this.buffers_[T]=N;case 44:C++,e.next=35;break;case 47:A=0,E=Object.entries(h);case 48:if(!(A<E.length)){e.next=62;break}if(D=Object(v.a)(E[A],2),z=D[0],(M=D[1]).imageData){e.next=52;break}return e.abrupt("continue",59);case 52:return e.next=54,createImageBitmap(M.imageData);case 54:I=e.sent,U={width:I.width,height:I.height},q=s.createTexture({size:U,format:"rgba8unorm",usage:GPUTextureUsage.SAMPLED|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),s.queue.copyExternalImageToTexture({source:I},{texture:q},U),this.textures_[z]=q;case 59:A++,e.next=48;break;case 62:V=function(e){if("builtin-uniforms"===e)return{buffer:be.builtinUniforms_};var t=be.blueprint_.nodes[e];if(!t)throw new Error("unknown node ".concat(e));switch(t.type){case"buffer":var n=be.buffers_[e];if(!n)throw new Error("unknown buffer ".concat(e));return{buffer:n};case"texture":var r=be.textures_[e];if(!r)throw new Error("unknown texture ".concat(e));return r.createView();default:throw new Error("unsupported binding resource type '".concat(t.type,"'"))}},F=function(e){var t,n,r=null!==(t=u[e])&&void 0!==t?t:[];r[0]||(r[0]={layout:[],bindings:new Map});var i="render"===(null===(n=be.blueprint_.nodes[e])||void 0===n?void 0:n.type)?GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT:GPUShaderStage.COMPUTE;r[0].layout.unshift({binding:0,visibility:i,buffer:{type:"uniform"}}),r[0].bindings.set(0,"builtin-uniforms");var a=r.map((function(e,t){var n;return s.createBindGroupLayout({entries:null!==(n=e.layout)&&void 0!==n?n:[]})}));return{layout:s.createPipelineLayout({bindGroupLayouts:a}),bindGroups:r.map((function(e,t){return s.createBindGroup({layout:a[t],entries:Array.from(e.bindings.entries()).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return{binding:n,resource:V(r)}}))})}))}},G=new Map,L=function(){var e,n,r=Object(v.a)(X[H],2),i=r[0],a=r[1],o=be.shaders_[a.vertexShader],c=be.shaders_[a.fragmentShader];if(!o||!c)return"continue";var u=F(i),l=u.layout,d=u.bindGroups,p=null!==(e=a.topology)&&void 0!==e?e:"triangle-list",h="line-strip"===p||"triangle-strip"===p?"uint32":void 0,f=s.createRenderPipeline({layout:l,vertex:{module:be.shaders_[a.vertexShader],entryPoint:a.vertexEntryPoint},primitive:{topology:p,stripIndexFormat:h,cullMode:"none"},fragment:{targets:[{format:t}],module:be.shaders_[a.fragmentShader],entryPoint:a.fragmentEntryPoint},depthStencil:{format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:null!==(n=a.depthTest)&&void 0!==n?n:"always"}}),b=s.createRenderBundleEncoder({colorFormats:[t],depthStencilFormat:"depth24plus-stencil8"});b.setPipeline(f),d.forEach((function(e,t){e&&b.setBindGroup(t,e)})),b.draw(a.numVertices,a.numInstances),G.set(i,{type:"render",descriptor:a,bundle:b.finish()})},H=0,X=Object.entries(f);case 67:if(!(H<X.length)){e.next=74;break}if("continue"!==L()){e.next=71;break}return e.abrupt("continue",71);case 71:H++,e.next=67;break;case 74:W=0,Q=Object.entries(b);case 75:if(!(W<Q.length)){e.next=86;break}if(Y=Object(v.a)(Q[W],2),J=Y[0],K=Y[1],this.shaders_[K.shader]){e.next=80;break}return e.abrupt("continue",83);case 80:Z=F(J),$=Z.layout,ee=Z.bindGroups,te=s.createComputePipeline({layout:$,compute:{module:this.shaders_[K.shader],entryPoint:K.entryPoint}}),G.set(J,{type:"compute",descriptor:K,bindGroups:ee,pipeline:te});case 83:W++,e.next=75;break;case 86:ne=Object.values(null!==(r=this.blueprint_.edges)&&void 0!==r?r:{}),re=new Map,ie=new Set(G.keys()),ae=0,se=ne;case 90:if(!(ae<se.length)){e.next=99;break}if("queue-dependency"===(oe=se[ae]).type){e.next=94;break}return e.abrupt("continue",96);case 94:re.set(oe.source,oe.target),ie.delete(oe.target);case 96:ae++,e.next=90;break;case 99:if(0!==ie.size){e.next=101;break}throw new Error("No usable passes compiled");case 101:for(ce=Array.from(ie);this.passes_.length<G.size;){(ue=this.passes_).push.apply(ue,Object(y.a)(ce.map((function(e){return G.get(e)})))),le=[],de=Object(_.a)(ce);try{for(de.s();!(pe=de.n()).done;)he=pe.value,(fe=re.get(he))&&le.push(fe)}catch(i){de.e(i)}finally{de.f()}ce=le}return e.abrupt("return",a);case 104:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateUniforms",value:function(e){var t,n,r,i,a,s,o;if(this.gpu_.isAcquired&&this.builtinUniforms_){var c=this.gpu_.device,u=new ArrayBuffer(24),l=new Float32Array(u),d=new Uint32Array(u);l[0]=null!==(t=e.time)&&void 0!==t?t:0,l[1]=null!==(n=e.timeDelta)&&void 0!==n?n:0,d[2]=null!==(r=e.frame)&&void 0!==r?r:0,d[4]=null!==(i=null===(a=e.resolution)||void 0===a?void 0:a.width)&&void 0!==i?i:1,d[5]=null!==(s=null===(o=e.resolution)||void 0===o?void 0:o.height)&&void 0!==s?s:1,c.queue.writeBuffer(this.builtinUniforms_,0,u,0,24)}}},{key:"execute",value:function(e,t){var n=t.width,r=t.height;if(this.gpu_.isAcquired){var i=this.gpu_.device,a=i.createCommandEncoder();null!==this.outputDepthStencilTexture_&&this.outputDepthStencilTextureSize_.width===n&&this.outputDepthStencilTextureSize_.height===r||(null!==this.outputDepthStencilTexture_&&(this.outputDepthStencilTexture_.destroy(),this.outputDepthStencilTexture_=null),this.outputDepthStencilTexture_=i.createTexture({size:{width:n,height:r},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.outputDepthStencilTextureSize_={width:n,height:r});var s,o=Object(_.a)(this.passes_);try{for(o.s();!(s=o.n()).done;){var c=s.value;if("compute"===c.type)!function(){var e=a.beginComputePass(),t=c.descriptor.dispatchSize;e.setPipeline(c.pipeline),c.bindGroups.forEach((function(t,n){t&&e.setBindGroup(n,t)})),e.dispatch(t.x,t.y,t.z),e.endPass()}();else{var u,l=c.descriptor.clear?null!==(u=c.descriptor.clearColor)&&void 0!==u?u:{r:0,g:0,b:0,a:1}:"load",d=a.beginRenderPass({colorAttachments:[{view:e.createView(),loadValue:l,storeOp:"store"}],depthStencilAttachment:{view:this.outputDepthStencilTexture_.createView(),depthLoadValue:c.descriptor.clear?1:"load",depthStoreOp:"store",stencilLoadValue:1,stencilStoreOp:"store"}});d.executeBundles([c.bundle]),d.endPass()}}}catch(h){o.e(h)}finally{o.f()}var p=a.finish();i.queue.submit([p])}}}],[{key:"compile",value:function(){var t=Object(a.a)(i.a.mark((function t(n,r,a){var s,o,c,u,l,d,p,h,f,b,g,m,j,x,C,k,w,T,S,P,N,R,B;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.isAcquired){t.next=2;break}return t.abrupt("return",{shaderInfo:{},messages:["GPU has been lost"]});case 2:for(s={},o=0,c=Object.values(r.nodes);o<c.length;o++)"render"===(u=c[o]).type?(""!==u.vertexShader&&(s[u.vertexShader]=!0),""!==u.fragmentShader&&(s[u.fragmentShader]=!0)):"compute"===u.type&&""!==u.shader&&(s[u.shader]=!0);for(l=n.device,d={},p=0,h=Object.entries(r.shaders);p<h.length;p++)f=Object(v.a)(h[p],2),b=f[0],g=f[1],d[b]=l.createShaderModule({code:O+g.code});m=!1,j={},x=0,C=Object.entries(d);case 10:if(!(x<C.length)){t.next=22;break}return k=Object(v.a)(C[x],2),w=k[0],T=k[1],t.next=14,T.compilationInfo();case 14:S=t.sent,j[w]={messages:S.messages.map((function(e){return{message:e.message,type:e.type,lineNum:e.lineNum,linePos:e.linePos,offset:e.offset,length:e.length}}))},P=Object(_.a)(S.messages);try{for(P.s();!(N=P.n()).done;)"error"===N.value.type&&s[w]&&(m=!0)}catch(i){P.e(i)}finally{P.f()}S.messages.some((function(e){return"error"===e.type}))&&s[w]&&(m=!0);case 19:x++,t.next=10;break;case 22:if(!m){t.next=24;break}return t.abrupt("return",{shaderInfo:j,messages:["One or more shaders failed to compile"]});case 24:return R=new e(n,r,d,j),B=[],t.prev=26,t.next=29,R.compile_(a);case 29:B=t.sent,t.next=36;break;case 32:return t.prev=32,t.t0=t.catch(26),console.log("Compilation failed: "+t.t0.message),t.abrupt("return",{shaderInfo:{},messages:[].concat(Object(y.a)(B),[t.t0.message])});case 36:return t.abrupt("return",{executable:R,shaderInfo:j,messages:B});case 37:case"end":return t.stop()}}),t,null,[[26,32]])})));return function(e,n,r){return t.apply(this,arguments)}}()}]),e}(),k=function(){function e(){var t=this;Object(h.a)(this,e),this.adapter_=void 0,this.device_=void 0,this.lost_=void 0,this.pendingAcquisition_=void 0,this.onAcquired=void 0,this.onLost=void 0,this.acquire=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===t.pendingAcquisition_&&(t.pendingAcquisition_=t.acquireInternal_()),e.abrupt("return",t.pendingAcquisition_);case 2:case"end":return e.stop()}}),e)}))),this.release=function(){if(!t.isAcquired)throw new Error("not acquired");t.adapter_=null,t.device_=null},this.onLost_=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.warn("Lost GPU. Reacquiring after short delay..."),t.adapter_=null,t.device_=null,null==t.onLost){e.next=6;break}return e.next=6,t.onLost();case 6:return e.next=8,new Promise((function(e){return setTimeout(e,1e3)}));case 8:case"end":return e.stop()}}),e)}))),this.adapter_=null,this.device_=null,this.lost_=!1,this.pendingAcquisition_=null,this.onAcquired=null,this.onLost=null,this.acquire()}return Object(f.a)(e,[{key:"isAcquired",get:function(){return null!==this.adapter_}},{key:"isLost",get:function(){return!this.isAcquired}},{key:"adapter",get:function(){return this.adapter_}},{key:"device",get:function(){return this.device_}},{key:"acquireInternal_",value:function(){var e=Object(a.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAcquired){e.next=2;break}throw new Error("already acquired.");case 2:return e.next=4,navigator.gpu.requestAdapter();case 4:if(t=e.sent){e.next=7;break}throw new Error("no webgpu adapter available");case 7:return e.prev=7,e.next=10,t.requestDevice();case 10:if(n=e.sent){e.next=13;break}throw new Error("no webgpu device available");case 13:this.device_=n,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.log(e.t0);case 19:if(this.pendingAcquisition_=null,this.adapter_=t,this.device_.lost.then(this.onLost_),null===this.onAcquired){e.next=25;break}return e.next=25,this.onAcquired();case 25:case"end":return e.stop()}}),e,this,[[7,16]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),w=function(){function e(){var t=this;Object(h.a)(this,e),this.gpu_=void 0,this.preferredTargetTextureFormat_=void 0,this.lastUsedContext_=void 0,this.lastUsedResolution_=void 0,this.startTime_=void 0,this.lastFrameTime_=void 0,this.frame_=void 0,this.blueprint_=void 0,this.lastCompiledDescriptor_=void 0,this.mostRecentPendingCompile_=void 0,this.executable_=void 0,this.onShadersCompiled=void 0,this.onGpuAcquired_=function(){t.executable_=null,t.tryCompile_()},this.tryCompile_=Object(a.a)(i.a.mark((function e(){var n,r,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.gpu_.isAcquired&&t.blueprint_){e.next=2;break}return e.abrupt("return");case 2:if(!t.lastCompiledDescriptor_||!x(t.lastCompiledDescriptor_,t.blueprint_)){e.next=4;break}return e.abrupt("return");case 4:return r=t.blueprint_,a=C.compile(t.gpu_,r,t.preferredTargetTextureFormat_),t.mostRecentPendingCompile_=a,e.next=9,a;case 9:if(s=e.sent,a===t.mostRecentPendingCompile_){e.next=12;break}return e.abrupt("return");case 12:t.lastCompiledDescriptor_=r,t.mostRecentPendingCompile_=null,t.onShadersCompiled&&t.onShadersCompiled(s.shaderInfo),t.executable_=null!==(n=s.executable)&&void 0!==n?n:null;case 16:case"end":return e.stop()}}),e)}))),this.gpu_=new k,this.gpu_.onAcquired=this.onGpuAcquired_,this.frame_=0,this.blueprint_=null,this.lastCompiledDescriptor_=null,this.mostRecentPendingCompile_=null,this.executable_=null,this.preferredTargetTextureFormat_="bgra8unorm"}return Object(f.a)(e,[{key:"reconfigure",value:function(){this.lastCompiledDescriptor_=null,this.executable_=null,this.tryCompile_()}},{key:"setBlueprint",value:function(e){this.blueprint_&&x(this.blueprint_,e)||(this.blueprint_=j(e),this.executable_=null,this.tryCompile_())}},{key:"stop",value:function(){this.blueprint_=null,this.executable_=null}},{key:"render",value:function(e,t){var n;if(!this.gpu_||!this.gpu_.isAcquired)return null;var r=function(e){var t=e.getContext("webgpu");return null===t?null:t}(e);if(null===r)throw this.stop(),new Error("no webgpu context");var i=this.gpu_.device,a=r.getPreferredFormat(this.gpu_.adapter);if(this.lastUsedContext_&&this.lastUsedResolution_&&this.lastUsedContext_===r&&this.lastUsedResolution_.width===t.width&&this.lastUsedResolution_.height===t.height||(r.configure({device:i,format:a,size:Object(p.a)({},t)}),this.lastUsedResolution_=Object(p.a)({},t)),this.preferredTargetTextureFormat_!==a&&(this.preferredTargetTextureFormat_=a,this.executable_=null),this.executable_){e.style.filter="blur(0px)";var s=(new Date).getTime();void 0===this.startTime_&&(this.startTime_=s);var o=s-(null!==(n=this.lastFrameTime_)&&void 0!==n?n:s);this.lastFrameTime_=s,this.executable_.updateUniforms({time:(s-this.startTime_)/1e3,timeDelta:o/1e3,frame:this.frame_++,resolution:t});var c=r.getCurrentTexture();this.executable_.execute(c,t)}else this.mostRecentPendingCompile_||this.tryCompile_()}}]),e}(),T=(n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(55),n(56),n(57),n(58),n(59),n(60),n(61),n(62),n(63),n(64),n(65),n(66),n(67),n(68),n(69),n(70),n(71),n(72),n(73),n(74),n(75),n(76),n(77),n(78),n(79),n(80),n(81),n(82),n(83),n(84),n(85),n(86),n(87),n(88),n(89),n(90),n(91),n(92),n(93),n(94),n(95),n(96),n(97),n(98),n(99),n(100),n(101),["3024-day","3024-night","abbott","abcdef","ambiance-mobile","ambiance","ayu-dark","ayu-mirage","base16-dark","base16-light","bespin","blackboard","cobalt","colorforth","darcula","dracula","duotone-dark","duotone-light","eclipse","elegant","erlang-dark","gruvbox-dark","hopscotch","icecoder","idea","isotope","juejin","lesser-dark","liquibyte","lucario","material-darker","material-ocean","material-palenight","material","mbo","mdn-like","midnight","monokai","moxer","neat","neo","night","nord","oceanic-next","panda-syntax","paraiso-dark","paraiso-light","pastel-on-dark","railscasts","rubyblue","seti","shadowfox","solarized","ssms","the-matrix","tomorrow-night-bright","tomorrow-night-eighties","ttcn","twilight","vibrant-ink","xq-dark","xq-light","yeti","yonce","zenburn"]),S=(n(102),n(1)),P=function(e){var t=e.label,n=e.children;return Object(S.jsxs)("div",{className:"LabeledField",children:[Object(S.jsx)("div",{className:"Label",children:t}),Object(S.jsx)("div",{className:"Field",children:n})]})},N=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).pixelSizeToggleRef_=void 0,r.pixelSizeRef_=void 0,r.framebufferWidthRef_=void 0,r.framebufferHeightRef_=void 0,r.saveBlueprint_=function(){var e=prompt("Name it!");null!==e&&""!==e&&r.props.onSaveBlueprint(e)},r.loadBlueprint_=function(e){r.props.onLoadBlueprint(e),r.toggleLoadBlueprintPanel_()},r.deleteBlueprint_=function(e){r.props.onDeleteBlueprint(e)},r.toggleLoadBlueprintPanel_=function(){r.setState((function(e,t){return{loadMenuVisible:!e.loadMenuVisible}}))},r.toggleOptions_=function(){r.setState((function(e,t){return{optionsVisible:!e.optionsVisible}}))},r.enterFullscreen_=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:document.querySelector("canvas").requestFullscreen();case 1:case"end":return e.stop()}}),e)}))),r.setAspectRatio_=function(e){r.props.onDisplayConfigChange({aspect:e.currentTarget.value}),r.toggleOptions_()},r.updateResolution_=function(e){var t=e.currentTarget;if(t!==r.pixelSizeToggleRef_.current&&"pixelSize"!==t.name){var n={width:parseInt(r.framebufferWidthRef_.current.value),height:parseInt(r.framebufferHeightRef_.current.value)};isNaN(n.width)||isNaN(n.height)||r.props.onDisplayConfigChange({resolution:{mode:"framebuffer",framebufferSize:n}})}else{var i=parseInt(r.pixelSizeRef_.current.value);isNaN(i)||r.props.onDisplayConfigChange({resolution:{mode:"pixel",pixelSize:i}})}},r.state={optionsVisible:!1,loadMenuVisible:!1},r.pixelSizeToggleRef_=u.a.createRef(),r.pixelSizeRef_=u.a.createRef(),r.framebufferWidthRef_=u.a.createRef(),r.framebufferHeightRef_=u.a.createRef(),r}return Object(f.a)(n,[{key:"render",value:function(){var e,t,n,r,i,a=this,s=this.props.displayConfig,o=function(e){return Object(S.jsxs)("label",{children:[Object(S.jsx)("input",{type:"radio",name:"aspect",value:e,onChange:a.setAspectRatio_,checked:e===s.aspect}),e]})};return Object(S.jsxs)("div",{className:"ControlPanel",children:[Object(S.jsx)("button",{className:"Toggle",title:"Options",onClick:this.toggleOptions_,children:"\u2699\ufe0f"}),Object(S.jsx)("button",{className:"Toggle",title:"Toggle Fullscreen",onClick:this.enterFullscreen_,children:"\ud83d\udda5\ufe0f"}),this.state.optionsVisible&&Object(S.jsxs)("div",{className:"OptionsPanel",children:[Object(S.jsx)("h1",{children:"Display Options"}),Object(S.jsx)("h2",{children:"Aspect Ratio"}),o("None"),o("1:1"),o("4:3"),o("16:9"),o("16:10"),Object(S.jsx)("h2",{children:"Resolution"}),Object(S.jsxs)("label",{children:[Object(S.jsx)("input",{type:"radio",name:"resolution",value:"pixel",ref:this.pixelSizeToggleRef_,onChange:this.updateResolution_,checked:"pixel"===s.resolution.mode}),"Fixed Pixel Size",Object(S.jsx)("input",{type:"number",name:"pixelSize",value:null!==(e=s.resolution.pixelSize)&&void 0!==e?e:1,ref:this.pixelSizeRef_,style:{width:"3em",marginLeft:"1em"},onChange:this.updateResolution_})]}),Object(S.jsxs)("label",{children:[Object(S.jsx)("input",{type:"radio",name:"resolution",value:"framebuffer",onChange:this.updateResolution_,checked:"framebuffer"===s.resolution.mode}),"Fixed Framebuffer Size",Object(S.jsx)("input",{type:"text",name:"framebufferWidth",style:{width:"4em",marginLeft:"1em"},ref:this.framebufferWidthRef_,value:null!==(t=null===(n=s.resolution.framebufferSize)||void 0===n?void 0:n.width)&&void 0!==t?t:4,onChange:this.updateResolution_}),"x",Object(S.jsx)("input",{type:"text",name:"framebufferHeight",style:{width:"4em"},ref:this.framebufferHeightRef_,value:null!==(r=null===(i=s.resolution.framebufferSize)||void 0===i?void 0:i.height)&&void 0!==r?r:4,onChange:this.updateResolution_})]}),Object(S.jsx)("h1",{children:"Editor Options"}),Object(S.jsx)(P,{label:"Theme",children:Object(S.jsx)("select",{value:this.props.codeMirrorTheme,onChange:function(e){return a.props.onCodeMirrorThemeChange(e.currentTarget.value)},children:T.map((function(e){return Object(S.jsx)("option",{value:e,children:e},e)}))})})]}),Object(S.jsx)("button",{className:"Toggle",onClick:this.saveBlueprint_,title:"Save Blueprint",children:"\ud83d\udcbe"}),Object(S.jsx)("button",{className:"Toggle",onClick:this.toggleLoadBlueprintPanel_,title:"Load Blueprint",children:"\ud83d\udcc2"}),this.state.loadMenuVisible&&Object(S.jsxs)("div",{className:"LoadBlueprintPanel",children:[Object(S.jsx)("h1",{children:"Saved Shaders"}),Object.entries(this.props.savedBlueprints).map((function(e){var t=Object(v.a)(e,2),n=t[0];t[1];return Object(S.jsxs)("div",{className:"LoadMenuItem",children:[Object(S.jsx)("div",{className:"LoadMenuName",onClick:function(){return a.loadBlueprint_(n)},children:n}),Object(S.jsx)("button",{className:"LoadMenuRemove",onClick:function(){return a.deleteBlueprint_(n)},children:"x"})]},n)}))]})]})}}]),n}(u.a.Component),R=(n(104),function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).wrapperRef_=void 0,r.canvasRef_=void 0,r.pendingFrameRequest_=void 0,r.wrapperRef_=u.a.createRef(),r.canvasRef_=u.a.createRef(),r.pendingFrameRequest_=null,r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=this;!function t(){var n=e.wrapperRef_.current,r=e.canvasRef_.current,i=n.clientWidth,a=n.clientHeight;r.width===i&&r.height===a||(r.width=i,r.height=a),e.props.render(r),e.pendingFrameRequest_=requestAnimationFrame(t)}()}},{key:"componentWillUnmount",value:function(){null!==this.pendingFrameRequest_&&(cancelAnimationFrame(this.pendingFrameRequest_),this.pendingFrameRequest_=null)}},{key:"render",value:function(){var e=this.props.config.aspect.split(":").map((function(e){return parseInt(e)})),t=Object(v.a)(e,2),n=t[0],r=t[1],i=isNaN(n)||isNaN(r),a={height:i?"100%":"auto",aspectRatio:i?"auto":"".concat(n,"/").concat(r)};return Object(S.jsx)("div",{className:"Display",children:Object(S.jsx)("div",{ref:this.wrapperRef_,className:"CanvasWrapper",style:a,children:Object(S.jsx)("canvas",{ref:this.canvasRef_})})})}}]),n}(u.a.Component)),B=(n(105),n(106),n(6));n(19);function A(e){return function(t){var n=t.id,r=t.sourceX,i=t.sourceY,a=t.targetX,s=t.targetY,o=t.sourcePosition,c=t.targetPosition,u=t.style,l=void 0===u?{}:u,d=t.data,p=t.arrowHeadType,h=t.markerEndId,f=Object(B.c)({sourceX:r,sourceY:i,sourcePosition:o,targetX:a,targetY:s,targetPosition:c}),b=Object(B.e)(p,h),g=Object(B.d)({sourceX:r,sourceY:i,targetX:a,targetY:s}),m=Object(v.a)(g,2),j=m[0],x=m[1],y=d,_=y.descriptor;return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("path",{id:n,style:l,className:"react-flow__edge-path",d:f,markerEnd:b}),Object(S.jsx)("foreignObject",{width:e.width,height:e.height,x:j-e.width/2,y:x-e.height/2,children:Object(S.jsx)("div",{className:"Edge Edge-".concat(_.type),children:e.render(y)})})]})}}var E=A({width:150,height:85,render:function(e){return Object(S.jsxs)("div",{children:[Object(S.jsx)("button",{className:"RemoveButton",onClick:e.destroy,children:"X"}),Object(S.jsxs)("select",{value:e.descriptor.storageType,style:{width:"8em",marginLeft:"1em"},onChange:function(t){return e.onChange({storageType:t.currentTarget.value})},children:[Object(S.jsx)("option",{value:"storage-read",children:"Storage (r/o)"}),Object(S.jsx)("option",{value:"storage",children:"Storage (r/w)"}),Object(S.jsx)("option",{value:"uniform",children:"Uniform"}),Object(S.jsx)("option",{value:"sampler",children:"Sampler"}),Object(S.jsx)("option",{value:"texture",children:"Texture"})]}),Object(S.jsxs)("div",{children:[Object(S.jsxs)("div",{className:"Row",children:["Group",Object(S.jsx)("input",{type:"number",value:e.descriptor.group,onChange:function(t){return e.onChange({group:t.currentTarget.valueAsNumber})}})]}),Object(S.jsxs)("div",{className:"Row",children:["Binding",Object(S.jsx)("input",{type:"number",value:e.descriptor.binding,onChange:function(t){return e.onChange({binding:t.currentTarget.valueAsNumber})}})]})]})]})}}),D=A({width:24,height:24,render:function(e){return Object(S.jsx)("div",{children:Object(S.jsx)("button",{className:"RemoveButton",onClick:e.destroy,children:"X"})})}}),z=(n(107),function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,i;return Object(h.a)(this,n),(i=t.call(this,e)).onClick_=function(e){!1!==i.props.enabled&&i.setState({isEditing:!0})},i.commit_=function(e){var t=e.trim();""!==t?(i.setState({value:t,isEditing:!1}),i.props.onChange(t)):i.setState({isEditing:!1})},i.onKeyDown_=function(e){"Enter"===e.key?i.commit_(e.currentTarget.value):"Escape"===e.key&&i.setState({isEditing:!1})},i.onFocusOut_=function(e){i.commit_(e.currentTarget.value)},i.state={value:null!==(r=e.value)&&void 0!==r?r:"",isEditing:!1},i}return Object(f.a)(n,[{key:"render",value:function(){var e,t=""===this.state.value,n=this.state.isEditing,r=n?"Editing":"NotEditing",i=t?"Empty":"NotEmpty",a=t?null!==(e=this.props.emptyText)&&void 0!==e?e:"":this.state.value;return Object(S.jsx)("input",{className:"EditableLabel ".concat(r," ").concat(i),type:"text",onKeyDown:this.onKeyDown_,onBlur:this.onFocusOut_,defaultValue:a,readOnly:!n,onClick:this.onClick_,autoFocus:!0})}}]),n}(u.a.Component));function M(e){return function(t){var n=t.data.descriptor;return e.effect&&u.a.useEffect((function(){return e.effect(t.data,e.context)})),Object(S.jsxs)("div",{className:"Node Node-".concat(n.type),children:[Object(S.jsx)("button",{className:"RemoveButton",onClick:t.data.destroy,children:"X"}),Object(S.jsx)("div",{className:"Title",children:e.title}),Object(S.jsxs)("div",{className:"Content",children:[Object(S.jsx)(P,{label:"Name",children:Object(S.jsx)(z,{value:n.name,onChange:function(e){t.data.onChange({name:e})}})}),e.render(t.data,e.context)]})]})}}function I(e,t){if(!e.source||!e.target)return null;var n=t.nodes[e.source],r=t.nodes[e.target];return n&&r&&e.targetHandle?{source:n,target:r,sourceName:e.source,targetName:e.target,targetHandle:e.targetHandle}:null}function U(e,t){var n=I(e,t);return!!n&&(("buffer"===n.source.type||"texture"===n.source.type||"sampler"===n.source.type)&&(("render"===n.target.type||"compute"===n.target.type)&&("bindings"===n.targetHandle&&(!t.edges||!Object.values(t.edges).some((function(e){return"binding"===e.type&&e.source===n.sourceName&&e.target===n.targetName}))))))}function q(e,t){var n=I(e,t);return!!n&&(("render"===n.source.type||"compute"===n.source.type)&&(("render"===n.target.type||"compute"===n.target.type)&&(!t.edges||!Object.values(t.edges).some((function(e){return"queue-dependency"===e.type&&(e.source===n.sourceName||e.target===n.targetName)})))))}var V=M({title:"Buffer",render:function(e){return Object(S.jsxs)("div",{children:[Object(S.jsx)(B.a,{type:"source",className:"Handle Binding",position:"bottom",isValidConnection:function(t){return U(t,e.blueprint)}}),Object(S.jsx)(P,{label:"Size",children:Object(S.jsx)("input",{type:"number",value:e.descriptor.size,style:{width:"5em",textAlign:"right"},onChange:function(t){return e.onChange({size:t.currentTarget.valueAsNumber})}})}),Object(S.jsx)(P,{label:"Init",children:Object(S.jsxs)("select",{value:e.descriptor.init,style:{width:"10em"},onChange:function(t){return e.onChange({init:t.currentTarget.value})},children:[Object(S.jsx)("option",{value:"zero",children:"Zero"}),Object(S.jsx)("option",{value:"random-floats",children:"Random Floats"}),Object(S.jsx)("option",{value:"random-uints",children:"Random Uints"})]})})]})}}),F=M({title:"Compute Pass",render:function(e){return Object(S.jsxs)("div",{children:[Object(S.jsx)(B.a,{id:"bindings",type:"target",title:"Bindings",position:"top",className:"Handle Binding",isValidConnection:function(t){return U(t,e.blueprint)}}),Object(S.jsx)(B.a,{id:"queueIn",type:"target",title:"Queue In",position:"left",className:"Handle Queue",isValidConnection:function(t){return q(t,e.blueprint)}}),Object(S.jsx)(B.a,{id:"queueOut",type:"source",title:"Queue Out",position:"right",className:"Handle Queue",isValidConnection:function(t){return q(t,e.blueprint)}}),Object(S.jsx)(P,{label:"Shader",children:Object(S.jsxs)("select",{value:e.descriptor.shader,onChange:function(t){return e.onChange({shader:t.currentTarget.value})},children:[Object(S.jsx)("option",{value:""}),Object.entries(e.blueprint.shaders).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return Object(S.jsx)("option",{value:n,children:r.name},n)}))]})}),Object(S.jsx)(P,{label:"Entry Point",children:Object(S.jsx)(z,{emptyText:"None",value:e.descriptor.entryPoint,onChange:function(t){return e.onChange({entryPoint:t})}})}),Object(S.jsx)(P,{label:"Dispatch Size",children:Object(S.jsxs)("div",{className:"DispatchSize",children:[Object(S.jsxs)("div",{className:"DispatchSizeElement",children:["X"," ",Object(S.jsx)("input",{type:"number",value:e.descriptor.dispatchSize.x,onChange:function(t){return e.onChange({dispatchSize:{x:t.currentTarget.valueAsNumber,y:e.descriptor.dispatchSize.y,z:e.descriptor.dispatchSize.z}})}})]}),Object(S.jsxs)("div",{className:"DispatchSizeElement",children:["Y"," ",Object(S.jsx)("input",{type:"number",value:e.descriptor.dispatchSize.y,onChange:function(t){return e.onChange({dispatchSize:{x:e.descriptor.dispatchSize.x,y:t.currentTarget.valueAsNumber,z:e.descriptor.dispatchSize.z}})}})]}),Object(S.jsxs)("div",{className:"DispatchSizeElement",children:["Z"," ",Object(S.jsx)("input",{type:"number",value:e.descriptor.dispatchSize.z,onChange:function(t){return e.onChange({dispatchSize:{x:e.descriptor.dispatchSize.x,y:e.descriptor.dispatchSize.y,z:t.currentTarget.valueAsNumber}})}})]})]})})]})}});function G(e){var t=[e.r,e.g,e.b].map((function(e){return"".concat((t=255*e)<16?"0":"").concat(t.toString(16));var t}));return"#".concat(t.join(""))}function L(e){var t=function(t){return parseInt(e.slice(t,t+2),16)/255};return{r:t(1),g:t(3),b:t(5),a:1}}var H=M({title:"Render Pass",render:function(e){var t,n,r,i;return Object(S.jsxs)("div",{children:[Object(S.jsx)(B.a,{id:"bindings",type:"target",title:"Bindings",position:"top",className:"Handle Binding",isValidConnection:function(t){return U(t,e.blueprint)}}),Object(S.jsx)(B.a,{id:"queueIn",type:"target",title:"Queue In",position:"left",className:"Handle Queue",isValidConnection:function(t){return q(t,e.blueprint)}}),Object(S.jsx)(B.a,{id:"queueOut",type:"source",title:"Queue Out",position:"right",className:"Handle Queue",isValidConnection:function(t){return q(t,e.blueprint)}}),Object(S.jsx)(P,{label:"Vertex Shader",children:Object(S.jsxs)("select",{value:e.descriptor.vertexShader,onChange:function(t){return e.onChange({vertexShader:t.currentTarget.value})},children:[Object(S.jsx)("option",{value:""}),Object.entries(e.blueprint.shaders).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return Object(S.jsx)("option",{value:n,children:r.name},n)}))]})}),Object(S.jsx)(P,{label:"Vertex Entry Point",children:Object(S.jsx)(z,{value:e.descriptor.vertexEntryPoint,emptyText:"None",onChange:function(t){return e.onChange({vertexEntryPoint:t})}})}),Object(S.jsx)(P,{label:"Fragment Shader",children:Object(S.jsxs)("select",{value:e.descriptor.fragmentShader,onChange:function(t){return e.onChange({fragmentShader:t.currentTarget.value})},children:[Object(S.jsx)("option",{value:""}),Object.entries(e.blueprint.shaders).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return Object(S.jsx)("option",{value:n,children:r.name},n)}))]})}),Object(S.jsx)(P,{label:"Fragment Entry Point",children:Object(S.jsx)(z,{value:e.descriptor.fragmentEntryPoint,emptyText:"None",onChange:function(t){return e.onChange({fragmentEntryPoint:t})}})}),Object(S.jsx)(P,{label:"Topology",children:Object(S.jsxs)("select",{value:null!==(t=e.descriptor.topology)&&void 0!==t?t:"triangle-list",onChange:function(t){return e.onChange({topology:t.currentTarget.value})},children:[Object(S.jsx)("option",{value:"point-list",children:"Point List"}),Object(S.jsx)("option",{value:"line-list",children:"Line List"}),Object(S.jsx)("option",{value:"line-strip",children:"Line Strip"}),Object(S.jsx)("option",{value:"triangle-list",children:"Triangle List"}),Object(S.jsx)("option",{value:"triangle-strip",children:"Triangle Strip"})]})}),Object(S.jsx)(P,{label:"# Vertices",children:Object(S.jsx)("input",{type:"number",value:e.descriptor.numVertices,onChange:function(t){return e.onChange({numVertices:Math.max(t.currentTarget.valueAsNumber,0)})}})}),Object(S.jsx)(P,{label:"# Instances",children:Object(S.jsx)("input",{type:"number",value:e.descriptor.numInstances,onChange:function(t){return e.onChange({numInstances:Math.max(t.currentTarget.valueAsNumber,0)})}})}),Object(S.jsx)(P,{label:"Clear",children:Object(S.jsx)("input",{type:"checkbox",checked:null!==(n=e.descriptor.clear)&&void 0!==n&&n,onChange:function(t){return e.onChange({clear:!e.descriptor.clear})}})}),Object(S.jsx)(P,{label:"Clear Color",children:Object(S.jsx)("input",{type:"color",value:G(null!==(r=e.descriptor.clearColor)&&void 0!==r?r:{r:0,g:0,b:0,a:1}),onChange:function(t){return e.onChange({clearColor:L(t.currentTarget.value)})}})}),Object(S.jsx)(P,{label:"Depth Test",children:Object(S.jsxs)("select",{value:null!==(i=e.descriptor.depthTest)&&void 0!==i?i:"always",onChange:function(t){return e.onChange({depthTest:t.currentTarget.value})},children:[Object(S.jsx)("option",{value:"never",children:"Never Pass"}),Object(S.jsx)("option",{value:"less",children:"<"}),Object(S.jsx)("option",{value:"less-equal",children:"<="}),Object(S.jsx)("option",{value:"equal",children:"="}),Object(S.jsx)("option",{value:"greater-equal",children:">="}),Object(S.jsx)("option",{value:"greater",children:">"}),Object(S.jsx)("option",{value:"not-equal",children:"\u2260"}),Object(S.jsx)("option",{value:"always",children:"Always Pass"})]})})]})}}),X=A({width:150,height:85,render:function(e){return Object(S.jsxs)("div",{children:[Object(S.jsx)("button",{className:"RemoveButton",onClick:e.destroy,children:"X"}),Object(S.jsxs)("div",{children:[Object(S.jsxs)("div",{className:"Row",children:["Group",Object(S.jsx)("input",{type:"number",value:e.descriptor.group,onChange:function(t){return e.onChange({group:t.currentTarget.valueAsNumber})}})]}),Object(S.jsxs)("div",{className:"Row",children:["Binding",Object(S.jsx)("input",{type:"number",value:e.descriptor.binding,onChange:function(t){return e.onChange({binding:t.currentTarget.valueAsNumber})}})]})]})]})}});function W(){return(W=Object(a.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return");case 2:if(r=t.getContext("2d")){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,createImageBitmap(n);case 7:if(a=e.sent){e.next=10;break}return e.abrupt("return");case 10:r.drawImage(a,0,0,a.width,a.height,0,0,128,128);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q={buffer:V,texture:M({title:"Texture",context:u.a.createRef(),effect:function(e,t){var n=t;n.current&&e.descriptor.imageData&&function(e,t){W.apply(this,arguments)}(n.current,e.descriptor.imageData)},render:function(e,t){return Object(S.jsxs)("div",{className:"TextureDetails",children:[Object(S.jsx)(B.a,{type:"source",className:"Handle Binding",position:"bottom",isValidConnection:function(t){return U(t,e.blueprint)}}),Object(S.jsx)("input",{type:"file",accept:"image/*",onChange:function(t){var n,r=(n=t.currentTarget).files&&0!==n.files.length?n.files[0]:null;r&&e.onChange({imageData:r})}}),Object(S.jsx)("canvas",{ref:t,className:"Preview",width:128,height:128})]})}}),compute:F,render:H},Y={"buffer-binding":E,"queue-dependency":D,"texture-binding":X};function J(e,t){for(var n=1;;++n){var r="".concat(t).concat(n);if(!e.hasOwnProperty(r))return r}}var K=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"componentDidCatch",value:function(e,t){console.log(e)}},{key:"render",value:function(){return this.props.children}}]),n}(u.a.Component),Z=function(e){return"render"===e.type||"compute"===e.type},$=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).isMounted_=void 0,r.update_=function(){r.isMounted_&&(r.setState({elements:ee(r.props.blueprint,r.update_)}),r.props.onChange())},r.onConnect_=function(e){var t=r.props.blueprint.nodes[e.source],n=r.props.blueprint.nodes[e.target];if(t&&n)return Z(n)&&"buffer"===t.type&&"bindings"===e.targetHandle?(r.addBufferBinding_(e.source,e.target),void r.props.onChange()):Z(n)&&"texture"===t.type&&"bindings"===e.targetHandle?(r.addTextureBinding_(e.source,e.target),void r.props.onChange()):Z(n)&&Z(t)&&"queueIn"===e.targetHandle?(r.addQueueDependency_(e.source,e.target),void r.props.onChange()):void 0},r.onElementClick_=function(e,t){},r.onMoveNode_=function(e,t){t.data.descriptor.position=Object(p.a)({},t.position),r.update_()},r.addShader_=function(){var e=r.props.blueprint.shaders,t=J(e,"shader");e[t]={name:t,code:""},r.update_()},r.addNode_=function(e,t){var n=r.props.blueprint.nodes,i=J(n,e);n[i]=Object(p.a)({name:i,type:e,position:{x:100,y:100}},t),r.update_()},r.addEdge_=function(e,t){var n,i=null!==(n=r.props.blueprint.edges)&&void 0!==n?n:{};r.props.blueprint.edges=i,i[J(i,e)]=Object(p.a)({type:e},t),r.update_()},r.addBuffer_=function(){r.addNode_("buffer",{size:16384,position:{x:100,y:100},init:"zero"})},r.addTexture_=function(){r.addNode_("texture",{position:{x:100,y:100},size:{width:1024,height:1024},format:"rgba8unorm",mipLevelCount:1,sampleCount:1})},r.addBufferBinding_=function(e,t){r.addEdge_("binding",{bindingType:"buffer",storageType:"storage-read",group:0,binding:1,source:e,target:t})},r.addTextureBinding_=function(e,t){r.addEdge_("binding",{bindingType:"texture",group:0,binding:1,source:e,target:t})},r.addQueueDependency_=function(e,t){r.addEdge_("queue-dependency",{source:e,target:t})},r.addRenderPass_=function(){r.addNode_("render",{vertexShader:"",vertexEntryPoint:"",fragmentShader:"",fragmentEntryPoint:"",topology:"triangle-list",numVertices:4,numInstances:1,indexed:!1,clear:!0,clearColor:{r:0,g:0,b:0,a:1}})},r.addComputePass_=function(){r.addNode_("compute",{shader:"",entryPoint:"",dispatchSize:{x:1,y:1,z:1}})},r.isMounted_=!1,r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.isMounted_=!0}},{key:"componentWillUnmount",value:function(){this.isMounted_=!1}},{key:"render",value:function(){return Object(S.jsx)("div",{className:"BlueprintEditor",children:Object(S.jsx)(K,{children:Object(S.jsx)(B.b,{nodeTypes:Q,edgeTypes:Y,elements:ee(this.props.blueprint,this.update_),elementsSelectable:!0,nodesConnectable:!0,nodesDraggable:!0,onConnect:this.onConnect_,onElementClick:this.onElementClick_,onNodeDragStop:this.onMoveNode_,children:Object(S.jsxs)("div",{className:"Toolbar",children:[Object(S.jsx)("button",{onClick:this.addShader_,children:"+Shader"}),Object(S.jsx)("button",{onClick:this.addBuffer_,children:"+Buffer"}),Object(S.jsx)("button",{onClick:this.addTexture_,children:"+Texture"}),Object(S.jsx)("button",{onClick:this.addRenderPass_,children:"+Render Pass"}),Object(S.jsx)("button",{onClick:this.addComputePass_,children:"+Compute Pass"})]})})})})}}]),n}(u.a.Component);function ee(e,t){var n,r=[];return Object.entries(e.nodes).forEach((function(n){var i=Object(v.a)(n,2),a=i[0],s=i[1];r.push({id:a,type:s.type,data:{blueprint:e,descriptor:s,onChange:function(n){Object.assign(e.nodes[a],n),t()},destroy:function(){if(delete e.nodes[a],e.edges)for(var n=0,r=Object.entries(e.edges);n<r.length;n++){var i=Object(v.a)(r[n],2),s=i[0],o=i[1];o.source!==a&&o.target!==a||delete e.edges[s]}t()}},position:s.position})})),Object.entries(null!==(n=e.edges)&&void 0!==n?n:{}).forEach((function(n){var i=Object(v.a)(n,2),a=i[0],s=i[1],o={blueprint:e,descriptor:s,onChange:function(n){Object.assign(e.edges[a],n),t()},destroy:function(){delete e.edges[a],t()}};switch(s.type){case"binding":r.push({id:a,source:s.source,target:s.target,targetHandle:"bindings",type:"".concat(s.bindingType,"-binding"),data:o});break;case"queue-dependency":r.push({id:a,source:s.source,target:s.target,targetHandle:"queueIn",type:"queue-dependency",data:o})}})),r}n(108),n(109);var te=n(25),ne=O.split(/\r\n|\r|\n/).length,re=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).isDecorating_=void 0,r.onChange_=function(e,t){r.props.onChange(e.getValue())},r.onUpdate_=function(e){var t,n;if(!r.isDecorating_){r.isDecorating_=!0,e.getAllMarks().forEach((function(e){return e.clear()})),e.clearGutter("GutterMessages");var i,a=Object(_.a)(null!==(t=null===(n=r.props.compilationInfo)||void 0===n?void 0:n.messages)&&void 0!==t?t:[]);try{for(a.s();!(i=a.n()).done;){var s=i.value,o="MarkedText-".concat(s.type),c=s.lineNum-ne;e.markText({line:c,ch:s.linePos-1},{line:c,ch:s.linePos+s.length-1},{className:o});var u=document.createElement("div");u.classList.add("Marker","Marker-".concat(s.type)),e.setGutterMarker(c,"GutterMessages",u)}}catch(l){a.e(l)}finally{a.f()}r.isDecorating_=!1}},r.isDecorating_=!1,r}return Object(f.a)(n,[{key:"render",value:function(){return Object(S.jsx)("div",{className:"CodeEditor",children:Object(S.jsx)(te.a,{value:this.props.contents,onChange:this.onChange_,onUpdate:this.onUpdate_,options:{theme:this.props.theme,keyMap:"sublime",mode:"rust",gutters:["GutterMessages"],readOnly:!this.props.mutable}})})}}]),n}(u.a.Component),ie=(n(120),function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={activeTab:0},r}return Object(f.a)(n,[{key:"render",value:function(){return Object(S.jsxs)("div",{className:"TabContainer",children:[this.renderTabs_(),Object(S.jsx)("div",{className:"ContentArea",children:this.renderActiveTabContent_()})]})}},{key:"renderTabs_",value:function(){var e=this,t=u.a.Children.toArray(this.props.children);return Object(S.jsx)("div",{className:"TabStrip",children:this.props.tabs.map((function(n,r){var i,a=e.state.activeTab===r,s=e.props.tabs.length-r;return Object(S.jsxs)("div",{style:{zIndex:a?t.length:s},className:"".concat(a?"Tab Active":"Tab Inactive","\n                          ").concat(n.mutable?"Removable":"Permanent"),onClick:function(t){return e.setActiveTab_(r)},children:[Object(S.jsx)(z,{enabled:n.mutable&&a,value:n.title,onChange:null!==(i=n.onRename)&&void 0!==i?i:function(){return{}}}),n.mutable&&Object(S.jsx)("button",{className:"RemoveButton",onClick:function(e){n.onClose&&n.onClose(),e.stopPropagation()},children:"x"})]},n.key+n.title)}))})}},{key:"setActiveTab_",value:function(e){this.setState({activeTab:e})}},{key:"renderActiveTabContent_",value:function(){var e=u.a.Children.toArray(this.props.children);if(0!==e.length){var t=this.state.activeTab;return t>=e.length?(this.setActiveTab_(0),e[0]):e[t]}}}]),n}(u.a.Component)),ae=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).removeShader_=function(t){delete e.props.blueprint.shaders[t],e.props.onBlueprintChange()},e.renameShader_=function(t,n){e.props.blueprint.shaders[t].name=n,e.props.onBlueprintChange()},e}return Object(f.a)(n,[{key:"render",value:function(){var e=this,t=Object.entries(this.props.blueprint.shaders);return Object(S.jsx)("div",{className:"Editor",children:Object(S.jsxs)(ie,{tabs:[{key:"Blueprint",title:"Blueprint",mutable:!1},{key:"Uniforms",title:"Uniforms",mutable:!1}].concat(Object(y.a)(t.map((function(t){var n=Object(v.a)(t,2),r=n[0],i=n[1];return{key:r,title:i.name,mutable:!0,onClose:function(){return e.removeShader_(r)},onRename:function(t){return e.renameShader_(r,t)}}})))),children:[Object(S.jsx)($,{blueprint:this.props.blueprint,onChange:this.props.onBlueprintChange}),Object(S.jsx)(re,{contents:O,mutable:!1,onChange:function(){return{}},theme:this.props.codeMirrorTheme},"Uniforms"),t.map((function(t){var n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(S.jsx)(re,{compilationInfo:e.props.compilationInfo[r],contents:i.code,mutable:!0,onChange:function(t){i.code=t,e.props.onBlueprintChange()},theme:e.props.codeMirrorTheme},r)}))]})})}}]),n}(u.a.Component),se=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).frameProducer_=void 0,r.onDisplayConfigChange=function(e){r.setState((function(t,n){return{displayConfig:Object.assign(Object(p.a)({},t.displayConfig),e)}}))},r.onFullscreenChange_=function(){r.frameProducer_.reconfigure()},r.onBlueprintChange_=function(){r.frameProducer_.setBlueprint(r.state.blueprint)},r.onShadersCompiled_=function(e){r.setState({compilationInfo:e})},r.onSaveBlueprint_=function(e){r.setState((function(t,n){return{savedBlueprints:Object(p.a)(Object(p.a)({},t.savedBlueprints),{},Object(d.a)({},e,j(t.blueprint)))}}))},r.onLoadBlueprint_=function(e){var t=j(r.state.savedBlueprints[e]);t&&(!function(e){for(var t=0,n=Object.entries(null!==(r=e.edges)&&void 0!==r?r:{});t<n.length;t++){var r,i=Object(v.a)(n[t],2)[1];i.sourceId&&(i.source=i.sourceId),i.targetId&&(i.target=i.targetId),i.bufferId&&(i.source=i.bufferId),i.passId&&(i.targetId=i.passId)}}(t),r.setState({blueprint:t}))},r.onDeleteBlueprint_=function(e){r.setState((function(t,n){return delete t.savedBlueprints[e],{savedBlueprints:t.savedBlueprints}}))},r.onCodeMirrorThemeChange_=function(e){r.setState({codeMirrorTheme:e})},r.state=Object(p.a)(Object(p.a)({},r.props.appState.value),{},{compilationInfo:{}}),r.frameProducer_=new w,r.frameProducer_.setBlueprint(r.state.blueprint),r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.frameProducer_.onShadersCompiled=this.onShadersCompiled_}},{key:"componentDidUpdate",value:function(){this.props.appState.value=this.state,this.frameProducer_.setBlueprint(this.state.blueprint)}},{key:"componentWillUnmount",value:function(){this.frameProducer_.stop()}},{key:"render",value:function(){var e=this;return Object(S.jsxs)("div",{className:"App",children:[Object(S.jsx)("div",{className:"App-header",children:Object(S.jsx)("div",{className:"App-title",children:"WebGPU Playground"})}),Object(S.jsxs)("div",{className:"App-top",children:[Object(S.jsx)("div",{className:"App-canvas",children:Object(S.jsx)(R,{render:function(t){var n,r=e.state.displayConfig;if("pixel"===r.resolution.mode){var i=r.resolution.pixelSize>=1?r.resolution.pixelSize:1;n={width:t.clientWidth/i,height:t.clientHeight/i}}else n=Object(p.a)({},r.resolution.framebufferSize);e.frameProducer_.render(t,n)},config:this.state.displayConfig})}),Object(S.jsx)("div",{className:"App-editor",children:Object(S.jsx)(ae,{compilationInfo:this.state.compilationInfo,blueprint:this.state.blueprint,onBlueprintChange:this.onBlueprintChange_,codeMirrorTheme:this.state.codeMirrorTheme})})]}),Object(S.jsx)("div",{className:"App-bottom",children:Object(S.jsx)(N,{displayConfig:this.state.displayConfig,onDisplayConfigChange:this.onDisplayConfigChange,savedBlueprints:this.state.savedBlueprints,onSaveBlueprint:this.onSaveBlueprint_,onLoadBlueprint:this.onLoadBlueprint_,onDeleteBlueprint:this.onDeleteBlueprint_,codeMirrorTheme:this.state.codeMirrorTheme,onCodeMirrorThemeChange:this.onCodeMirrorThemeChange_})})]})}}]),n}(u.a.Component),oe={blueprint:{nodes:{},edges:{},shaders:{}},savedBlueprints:{Basic:{nodes:{render1:{name:"render quad",position:{x:100,y:100},type:"render",indexed:!1,numVertices:6,numInstances:1,vertexShader:"vertex1",vertexEntryPoint:"main",fragmentShader:"fragment1",fragmentEntryPoint:"main"}},edges:{},shaders:{vertex1:{name:"Vertex",code:"[[stage(vertex)]]\nfn main([[builtin(vertex_index)]] index: u32)\n    -> [[builtin(position)]] vec4<f32> {\n  let x = select(-1.0, 1.0, index >= 1u && index <= 3u);\n  let y = select(-1.0, 1.0, index >= 2u && index <= 4u);\n  return vec4<f32>(x, y, 0.0, 1.0);\n}\n"},fragment1:{name:"Fragment",code:"[[stage(fragment)]]\nfn main([[builtin(position)]] coord: vec4<f32>)\n    -> [[location(0)]] vec4<f32> {\n  let uv = coord.xy / vec2<f32>(builtinUniforms.resolution.xy);\n  let col = 0.5 + 0.5 * cos(builtinUniforms.time + uv.xyx +\n                            vec3<f32>(0.0, 20.0, 40.0));\n  return vec4<f32>(col, 1.0);\n}\n"}}},Boids:{nodes:{compute1:{name:"update A",type:"compute",position:{x:580,y:50},shader:"compute1",entryPoint:"main",dispatchSize:{x:1e3,y:1,z:1}},render1:{name:"render boids",position:{x:580,y:370},type:"render",indexed:!1,numVertices:3,numInstances:1e3,vertexShader:"vertex1",vertexEntryPoint:"main",fragmentShader:"fragment1",fragmentEntryPoint:"main"},compute2:{name:"update B",type:"compute",position:{x:580,y:220},shader:"compute1",entryPoint:"main",dispatchSize:{x:1e3,y:1,z:1}},buffer1:{name:"particle data A",position:{x:10,y:100},type:"buffer",size:16e3,init:"random-floats"},buffer2:{name:"particle data B",position:{x:10,y:350},type:"buffer",size:16e3,init:"zero"}},edges:{binding1a:{type:"binding",bindingType:"buffer",storageType:"storage-read",group:0,binding:1,source:"buffer1",target:"compute1"},binding1b:{type:"binding",bindingType:"buffer",storageType:"storage-read",group:0,binding:1,source:"buffer1",target:"render1"},binding2:{type:"binding",bindingType:"buffer",storageType:"storage",group:0,binding:2,source:"buffer1",target:"compute2"},binding3:{type:"binding",bindingType:"buffer",storageType:"storage-read",group:0,binding:1,source:"buffer2",target:"compute2"},binding4:{type:"binding",bindingType:"buffer",storageType:"storage",group:0,binding:2,source:"buffer2",target:"compute1"}},shaders:{compute1:{name:"compute",code:"let kRule1Distance = 0.1;\nlet kRule2Distance = 0.025;\nlet kRule3Distance = 0.025;\nlet kRule1Scale = 0.02;\nlet kRule2Scale = 0.05;\nlet kRule3Scale = 0.005;\nlet kNumParticles = 1000u;\n\nstruct Particle {\n  pos: vec2<f32>;\n  vel: vec2<f32>;\n};\n\n[[block]] struct Particles {\n  particles: array<Particle>;\n};\n\n[[group(0), binding(1)]] var<storage, read> particlesA: Particles;\n[[group(0), binding(2)]] var<storage, read_write> particlesB: Particles;\n\n[[stage(compute), workgroup_size(1)]]\nfn main([[builtin(global_invocation_id)]] id: vec3<u32>) {\n  let index = id.x;\n  if (index >= kNumParticles) {\n    return;\n  }\n\n  var vPos = particlesA.particles[index].pos;\n  var vVel = particlesA.particles[index].vel;\n  var cMass = vec2<f32>(0.0, 0.0);\n  var cVel = vec2<f32>(0.0, 0.0);\n  var colVel = vec2<f32>(0.0, 0.0);\n  var cMassCount = 0u;\n  var cVelCount = 0u;\n  var pos: vec2<f32>;\n  var vel: vec2<f32>;\n\n  for (var i = 0u; i < kNumParticles; i = i + 1u) {\n    if (i == index) {\n      continue;\n    }\n    pos = particlesA.particles[i].pos.xy;\n    vel = particlesA.particles[i].vel.xy;\n    if (distance(pos, vPos) < kRule1Distance) {\n      cMass = cMass + pos;\n      cMassCount = cMassCount + 1u;\n    }\n    if (distance(pos, vPos) < kRule2Distance) {\n      colVel = colVel - (pos - vPos);\n    }\n    if (distance(pos, vPos) < kRule3Distance) {\n      cVel = cVel + vel;\n      cVelCount = cVelCount + 1u;\n    }\n  }\n\n  if (cMassCount > 0u) {\n    cMass = (cMass / vec2<f32>(f32(cMassCount), f32(cMassCount))) - vPos;\n  }\n\n  if (cVelCount > 0u) {\n    cVel = cVel / vec2<f32>(f32(cVelCount), f32(cVelCount));\n  }\n\n  vVel = vVel + (cMass * kRule1Scale) + (colVel * kRule2Scale) +\n      (cVel * kRule3Scale);\n\n  vVel = normalize(vVel) * clamp(length(vVel), 0.0, 1.0);\n  vPos = vPos + (vVel * builtinUniforms.timeDelta * 0.25);\n\n  if (vPos.x < -1.0) {\n    vPos.x = vPos.x + 2.0;\n  }\n  if (vPos.x > 1.0) {\n    vPos.x = vPos.x - 2.0;\n  }\n  if (vPos.y < -1.0) {\n    vPos.y = vPos.y + 2.0;\n  }\n  if (vPos.y > 1.0) {\n    vPos.y = vPos.y - 2.0;\n  }\n\n  particlesB.particles[index].pos = vPos;\n  particlesB.particles[index].vel = vVel;\n}\n"},vertex1:{name:"vertex",code:"struct Particle {\n  particlePos: vec2<f32>;\n  particleVel: vec2<f32>;\n};\n\n[[block]] struct Particles {\n  particles: array<Particle>;\n};\n\n[[group(0), binding(1)]] var<storage, read> particles: Particles;\n\nfn getPos(vid: u32) -> vec2<f32> {\n  return select(\n      vec2<f32>(-0.01, -0.02),\n      select(vec2<f32>(0.01, -0.02), vec2<f32>(0.00, 0.02), vid >= 2u),\n      vid >= 1u);\n}\n\n[[stage(vertex)]]\nfn main([[builtin(vertex_index)]] vid: u32,\n        [[builtin(instance_index)]] id: u32)\n    -> [[builtin(position)]] vec4<f32> {\n  let angle = -atan2(particles.particles[id].particleVel.x, particles.particles[id].particleVel.y);\n  let ppos = getPos(vid);\n  let pos = vec2<f32>(ppos.x * cos(angle) - ppos.y * sin(angle),\n                      ppos.x * sin(angle) + ppos.y * cos(angle));\n  return vec4<f32>(pos + particles.particles[id].particlePos, 0.0, 1.0);\n}\n"},fragment1:{name:"fragment",code:"[[stage(fragment)]]\nfn main() -> [[location(0)]] vec4<f32> {\n  return vec4<f32>(1.0, 1.0, 1.0, 1.0);\n}\n"}}},Instances:{nodes:{render1:{name:"render quad",position:{x:100,y:100},type:"render",indexed:!1,numVertices:6,numInstances:30,vertexShader:"vertex1",vertexEntryPoint:"main",fragmentShader:"fragment1",fragmentEntryPoint:"main"}},edges:{},shaders:{vertex1:{name:"Vertex",code:"[[stage(vertex)]]\nfn main([[builtin(vertex_index)]] index: u32,\n        [[builtin(instance_index)]] instance: u32)\n    -> [[builtin(position)]] vec4<f32> {\n  let t = builtinUniforms.time * 6.283 / 2.0;\n  let b = 1.0 + f32(instance / 10u) * 0.5;\n  let k = 0.5 + cos(t * 3.0) * 0.2;\n  let c = k * cos(t);\n  let s = k * sin(t);\n  let xo = cos(f32(instance) * 6.283 / 10.0) * 0.5 * b;\n  let yo = sin(f32(instance) * 6.283 / 10.0) * 0.5 * b;\n  let x = select(-1.0, 1.0, index >= 1u && index <= 3u) * 0.3;\n  let y = select(-1.0, 1.0, index >= 2u && index <= 4u) * 0.3;\n  return vec4<f32>(x * c - y * s + xo, x * s + y * c + yo, 0.0, 1.0);\n}\n"},fragment1:{name:"Fragment",code:"[[stage(fragment)]]\nfn main([[builtin(position)]] coord: vec4<f32>)\n    -> [[location(0)]] vec4<f32> {\n  let uv = coord.xy / vec2<f32>(builtinUniforms.resolution.xy);\n  let col = 0.5 + 0.5 * cos(builtinUniforms.time + uv.xyx + vec3<f32>(0.0, 20.0, 40.0));\n  return vec4<f32>(col, 1.0);\n}\n"}}}},displayConfig:{aspect:"1:1",resolution:{mode:"pixel",pixelSize:1}},codeMirrorTheme:"monokai"},ce=function(){function e(t){Object(h.a)(this,e),this.minDelayMs_=void 0,this.lastInvocationMs_=void 0,this.pendingInvocation_=void 0,this.minDelayMs_=t,this.lastInvocationMs_=null,this.pendingInvocation_=null}return Object(f.a)(e,[{key:"invoke",value:function(e){this.onCooldown()?this.scheduleSuppressed(e):this.invokeInternal(e)}},{key:"clearPendingInvocation",value:function(){null!==this.pendingInvocation_&&clearTimeout(this.pendingInvocation_),this.pendingInvocation_=null}},{key:"invokeInternal",value:function(e){this.clearPendingInvocation(),this.lastInvocationMs_=Date.now(),e()}},{key:"onCooldown",value:function(){return null!==this.lastInvocationMs_&&Date.now()-this.lastInvocationMs_<this.minDelayMs_}},{key:"scheduleSuppressed",value:function(e){null!==this.pendingInvocation_&&clearTimeout(this.pendingInvocation_);var t=this.lastInvocationMs_+this.minDelayMs_-Date.now();this.pendingInvocation_=setTimeout(this.invoke.bind(this,e),t)}}]),e}();function ue(e,t){for(var n=function(e){return"object"===typeof e&&null!==e},r=0,i=Object.entries(t);r<i.length;r++){var a=Object(v.a)(i[r],2),s=a[0],o=a[1];e.hasOwnProperty(s)?n(o)&&n(e[s])&&ue(e[s],o):Array.isArray(o)?e[s]=Object(y.a)(o):n(o)?e[s]=ue({},o):e[s]=o}return e}var le=function(){function e(t,n,r){Object(h.a)(this,e),this.key_=void 0,this.cachedValue_=void 0,this.debouncer_=void 0,this.key_=t,this.cachedValue_=n,this.debouncer_=new ce(r)}return Object(f.a)(e,[{key:"value",get:function(){return this.cachedValue_},set:function(e){var t=this;this.cachedValue_=e,this.debouncer_.invoke((function(){return o.a.setItem(t.key_,e)}))}}]),e}();function de(e){var t,n=localStorage[e],r=null;n&&(r=null!==(t=JSON.parse(n))&&void 0!==t?t:null);return null!==r?r:null}function pe(e){return he.apply(this,arguments)}function he(){return(he=Object(a.a)(i.a.mark((function e(t){var n,r,a,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.a.getItem(t.key),a=de(t.key),e.next=4,r;case 4:return s=e.sent,c=null,c=null!==s?s:null!==a&&void 0!==a?a:{},e.abrupt("return",new le(t.key,ue(c,t.default),null!==(n=t.debounceMs)&&void 0!==n?n:100));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(){return(fe=Object(a.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe({key:"gpu-app-state",default:oe});case 2:t=e.sent,Object(l.render)(Object(S.jsx)(u.a.StrictMode,{children:Object(S.jsx)(se,{appState:t})}),document.getElementById("root"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o.a.config({driver:o.a.INDEXEDDB,name:"shady",version:1,storeName:"local_state"}),function(){fe.apply(this,arguments)}()},19:function(e,t,n){},29:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){}},[[121,7,8]]]);
//# sourceMappingURL=main.8912799c.chunk.js.map